<div class="inventory-section newreceivingslipWrap">
	<h3 class="pageTitle">New Receiving Slip</h3>
	<div class="clearfix"></div>
	<div class="purchaseorderWrap">
		<div class="clearfix"></div>
		<div class="purchaseorderDetails">
			<div class="row">
				<div class="col-sm-6">
					<div class="row">
						<div class="col-sm-6">
							<div class="label-col">Purchase Order No.</div>
						</div>
						<div class="col-sm-6">
							<div class="info-col">{{poData.purchase_order_no}}</div>
						</div>
					</div>
					<div class="row">
						<div class="col-sm-6">
							<div class="label-col">Supplier</div>
						</div>
						<div class="col-sm-6">
							<div class="info-col">{{poData.supplier_name}}</div>
						</div>
					</div>
                </div>
                <div class="col-sm-6">
                    <div class="row">
						<div class="col-sm-6">
							<div class="label-col">Date</div>
						</div>
						<div class="col-sm-6">
							<div class="info-col">{{util.getFormatedDate(today)}}</div>
						</div>
					</div>
					<div class="row">
						<div class="col-sm-6">
							<div class="label-col">Generated by</div>
						</div>
						<div class="col-sm-6">
							<div class="info-col">{{poData.user_name ? poData.user_name.first_name : ''}}</div>
						</div>
					</div>
                </div>
			</div>
		</div>
		<div class="clearfix"></div>
		<div class="ordereditemsDetails" *ngIf="poData && poData.order_items.length > 0">
			<div class="serPart text-center">
				<span>Ordered Items</span>
			</div>
			<div class="">
				<div class="row">
					<div class="form-group clearfix">
						<div class="col-md-12 text-right">
							<div class="repeatonDay" *ngIf="poData.status != 'Completed'">
								<div class="checkBox">
									<label>
										<input autocomplete="nope" [(ngModel)]="receiveAll" type="checkbox" (change)="receiveAllCheck()">
										<span class="iconChk"><i class="fa fa-check"></i> </span>
										Receive All
									</label>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="table-responsive">
				<table class="table">
					<thead>
						<tr>
							<!-- <th>Item Category</th> -->
							<th>Manufacturer</th>
							<th>Item Definition</th>
							<th>Qty Expected (Units)</th>
							<th>Qty Received (Units)</th>
							<th></th>
						</tr>
					</thead>
					<tbody>
						<tr *ngFor="let item of poData.order_items">
							<!-- <td>{{item.item_manuf_parts_name.manuf_part_class_name.item_class_name}}</td> -->
							<td>{{item.item_manuf_name.manf_name}}</td>
							<td>{{item.item_manuf_parts_name.short_name}}</td>
							<td>{{item.quantity_ordered}}-({{item.quantity_received}})</td>
							<td>
                <div class="form-group">
                  <span *ngIf="item.quantity_ordered == item.quantity_received || item.quantity_ordered < item.quantity_received">{{item.quantity_received}}</span>
              <ng-container *ngIf="item.quantity_ordered != item.quantity_received && item.quantity_ordered > item.quantity_received" >
                  <input autocomplete="nope"  type="number" id="qtyReceived" name="qtyReceived" [(ngModel)]="item.qty_received" class="PadR0 form-control" required #qtyReceived="ngModel" [pattern]="constant.AMOUNT_PATTERN">
                  <span class="error-msg" *ngIf="qtyReceived.errors && (qtyReceived.dirty || qtyReceived.touched || submitted)">
                    <small *ngIf="qtyReceived.errors.required">Quantity is required.</small>
                    <small *ngIf="qtyReceived.errors.pattern">Invalid Quantity.</small>
                  </span>
                </ng-container>
                </div>
							</td>
							<td>
								<!-- @@ Commented code by Yogesh -->
								<img *ngIf="item.quantity_ordered != item.quantity_received && item.quantity_ordered > item.quantity_received" class="img-responsive" src="assets/icon/icon-13.png" (click)="accept(problemItemFm)">  <!--showPopup()  accept(auditForm)"   addProblemItem(item)-->
							</td>
						</tr>
					</tbody>
				</table>
			</div>
			<div class="clearfix"></div>
			<div class="margin30 unlistedBtn" *ngIf="poData.status != 'Completed'">
				<span (click)="showUnlistedItem()" class="addMore">
		           	<img src="assets/icon/icon-16.png" class="img-responsive" alt="Add Items">
		           	<span>Add Unlisted Item</span>
		        </span>
			</div>
		</div>
	</div>
	<div class="clearfix"></div>

	<div class="purchaseorderWrap">
		<div class="ordereditemsDetails" *ngIf="poData && poData.unlistedItems && poData.unlistedItems.length > 0">
			<div class="serPart text-center">
				<span>Unlisted Items</span>
			</div>
			<div class="table-responsive">
				<table class="table">
					<thead>
						<tr>
							<!-- <th>Item Category</th> -->
							<th>Manufacturer</th>
							<th>Item Definition</th>
							<th>Qty Received (Units)</th>
						</tr>
					</thead>
					<tbody>
						<tr *ngFor="let item of poData.unlistedItems">
							<!-- <td>{{item.manuf_parts_name.manuf_part_class_name.item_class_name}}</td> -->
							<td>{{item.manuf_name.manf_name}}</td>
							<td>{{item.manuf_parts_name.short_name}}</td>
							<td>{{item.quantity_received}}</td>
						</tr>
					</tbody>
				</table>
			</div>
			<div class="clearfix"></div>
		</div>
	</div>

	<div class="purchaseorderWrap">
		<div class="ordereditemsDetails problemItems" *ngIf="poData && poData.problemItems && poData.problemItems.length > 0">
			<div class="serPart text-center">
				<span>Problem Items</span>
			</div>
			<div class="table-responsive">
				<table class="table">
					<thead>
						<tr>
							<th>Manufacturer</th>
							<th>Item Definition</th>
							<th>Quantity</th>
							<th>Comment</th>
						</tr>
					</thead>
					<tbody>
						<tr *ngFor="let item of poData.problemItems">
							<td>{{item.po_item.item_manuf_name.manf_name}}</td>
							<td>{{item.po_item.item_manuf_parts_name.short_name}}</td>
							<td>{{item.quantity}}</td>
							<td>{{item.comment}}</td>
						</tr>
					</tbody>
				</table>
			</div>
			<div class="clearfix"></div>
		</div>
	</div>

	<form autocomplete="off" id="unlistedItemFm" role="form" [formGroup]="addUnlistedItemFm" *ngIf="poData && poData.unlistedItems">
		<div class="unlisteditemsDetails" *ngIf="unlisted_items.controls.length > 0">
			<div class="serPart text-center">
				<span>Unlisted Items</span>
			</div>
			<div class="table-responsive">
				<table class="table">
					<thead>
						<tr>
							<th></th>
							<!-- <th>Item Category</th> -->
							<th>Manufacturer</th>
							<th>Item Definition</th>
							<th>Qty Received (Units)</th>
							<th>Price/Unit</th>
						</tr>
					</thead>
					<tbody>
						<tr *ngFor="let uitem of unlisted_items.controls; let indx=index" [formGroup]="uitem">
							<td>
								<img class="img-responsive" src="assets/icon/close_icon.png" (click)="removeItem(indx)">
							</td>
							<!-- <td>
								<div class="form-group">
									<div class="autoCompleteList">
				                        <div class="searchList">
				                            <mat-form-field class="product">
				                                <input autocomplete="nope" id=class_name_{{indx}} matInput placeholder="" [formControl]="uitem.get('itemClass')" [matAutocomplete]="itemClassAutoComp" (keyup)="validateClass($event, uitem, indx)">
				                                <i *ngIf="uitem.get('itemClass').value!=''" (click)="util.clearAutoComplete('class_name_', [uitem.get('itemClassType'), uitem.get('itemClass'), uitem.get('itemClassId'), uitem.get('manufacturer'), uitem.get('manf_id'),uitem.get('manufacturerPart'), uitem.get('manf_part_id')], indx)" class="clearAutoComplete fa fa-times-circle" aria-hidden="true"></i>
				                                <img *ngIf="uitem.get('itemClass').value==''" class="selectBoxIcon" aria-hidden src="assets/icon/select.png" />
				                                <mat-autocomplete #itemClassAutoComp="matAutocomplete">
				                                    <mat-option *ngFor="let indxIn=index; let mitem of uitem.get('filteredClass').value | async" [value]="mitem.item_class_name" (onSelectionChange)="getSelectedClass(mitem, $event, indx)">
			                                        	<span>{{ mitem.item_class_name }}</span>
			                                        </mat-option>
				                                </mat-autocomplete>
				                            </mat-form-field>
				                        </div>
				                    </div>
									<span class="error-msg" *ngIf="uitem.get('itemClassId').invalid && (uitem.get('itemClassId').dirty || uitem.get('itemClassId').touched || submitted)">
				                      	<small *ngIf="uitem.get('itemClassId').errors.required">Please select Category from the list.</small>
				                    </span>
								</div>


							</td> -->
							<td>
								<div class="form-group" *ngIf="uitem.get('itemClassType').value != 'Material'">
									<div class="autoCompleteList">
										<div class="searchList">
											<mat-form-field class="product">
											<input autocomplete="nope" id=manf_name_{{indx}} matInput placeholder=""  [formControl]="uitem.get('manufacturer')" [matAutocomplete]="manufacturerAutoComp" (keyup)="validateManf($event, uitem, indx)">
											<i *ngIf="uitem.get('manufacturer').value!=''" (click)="util.clearAutoComplete('manf_name_', [uitem.get('manufacturer'), uitem.get('manf_id'), uitem.get('manufacturerPart'), uitem.get('manf_part_id')], indx)" class="clearAutoComplete fa fa-times-circle" aria-hidden="true"></i>
											<img *ngIf="uitem.get('manufacturer').value==''" class="selectBoxIcon" aria-hidden src="assets/icon/select.png" />
											<mat-autocomplete #manufacturerAutoComp="matAutocomplete">
											<mat-option *ngFor="let optionIndx=index; let item of uitem.get('filteredManufacturer').value | async" [value]="item.manf_name" (onSelectionChange)="getMfg(item, $event, indx)">
											<span>{{ item.manf_name }}</span>
											</mat-option>

											<mat-option (click)="showAddManufacturerPopup(indx)">
											<img aria-hidden src="assets/icon/icon-add.png" />
											<span>New Manufacturer</span>
											</mat-option>
											</mat-autocomplete>
											</mat-form-field>
										</div>
									</div>
									<span class="error-msg" *ngIf="(uitem.get('manf_id').invalid) && (uitem.get('manf_id').dirty || uitem.get('manf_id').touched || submitted)">
										<small *ngIf="uitem.get('manf_id').errors.required">Please select Manufacturer from the list.</small>
									</span>
								</div>
								<div class="form-group" *ngIf="uitem.get('itemClassType').value == 'Material'">
									<select class="form-control autoSelectAlternate">
										<option [value]="item.manf_id" *ngFor="let item of materialManufacturerList">{{item.manf_name}}</option>
									</select>
								</div>
							</td>
							<td>
								<div class="form-group">
									<div class="autoCompleteList">
										<div class="searchList">
											<mat-form-field class="product">
											<input autocomplete="nope" id=prod_name_{{indx}} matInput placeholder=""  [formControl]="uitem.get('manufacturerPart')" [matAutocomplete]="manufacturerPartAutoComp" (keyup)="validateManfPart($event, uitem, indx)">
											<i *ngIf="uitem.get('manufacturerPart').value!=''" (click)="util.clearAutoComplete('prod_name_', [uitem.get('manufacturerPart'), uitem.get('manf_part_id')], indx)" class="clearAutoComplete fa fa-times-circle" aria-hidden="true"></i>
											<img *ngIf="uitem.get('manufacturerPart').value==''" class="selectBoxIcon" aria-hidden src="assets/icon/select.png" />
											<mat-autocomplete #manufacturerPartAutoComp="matAutocomplete">
											<mat-option *ngFor="let optionIndx=index; let item of uitem.get('filteredManufacturerPart').value | async" [value]="item.short_name" (onSelectionChange)="getManfPart(item, $event, indx)">
											<span>{{ item.short_name }}</span>
											</mat-option>

											<mat-option (click)="showAddManufacturerPartPopup(indx)">
											<img aria-hidden src="assets/icon/icon-add.png" />
											<span>New Item Definition</span>
											</mat-option>
											</mat-autocomplete>
											</mat-form-field>
										</div>
									</div>
									<span class="error-msg" *ngIf="uitem.get('manf_part_id').invalid && (uitem.get('manf_part_id').dirty || uitem.get('manf_part_id').touched || submitted)">
										<small *ngIf="uitem.get('manf_part_id').errors.required">Please select Item Definition from the list.</small>
									</span>
								</div>
							</td>
							<td>
                <div class="form-group">
                  <input autocomplete="nope" type="number" formControlName="quantity_received" id="qtyReceived" name="qtyReceived" class="PadR0" (keypress)="util.numberCheck($event)" (keyup)="util.removeCommas(uitem.get('quantity_received'))">
                  <span class="error-msg" *ngIf="uitem.get('quantity_received').invalid && (uitem.get('quantity_received').dirty || uitem.get('quantity_received').touched || submitted)">
                    <small *ngIf="uitem.get('quantity_received').errors.required">Quantity is required.</small>
                    <small *ngIf="uitem.get('quantity_received').errors.pattern">Invalid Quantity.</small>
                  </span>
                </div>
							</td>
							<td>
								<input autocomplete="nope" type="text" id="Price" name="Price" formControlName="price_per_unit" class="form-control" (keyup)="util.removeCommas(uitem.get('price_per_unit'))">
								<span class="error-msg" *ngIf="uitem.get('price_per_unit').invalid && (uitem.get('price_per_unit').dirty || uitem.get('price_per_unit').touched || submitted)">
									<small *ngIf="uitem.get('price_per_unit').errors.required">Price/Unit is required.</small>
									<small *ngIf="uitem.get('price_per_unit').errors.pattern">Invalid Price/Unit.</small>
								</span>
							</td>
						</tr>
						<tr>
							<td></td>
							<td>
								<span (click)="addPurchaseItem()" class="addMore">
						           <img src="assets/icon/icon-16.png" class="img-responsive" alt="Add Items">
						           <span>Add Item</span>
						        </span>
							</td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>
	</form>
	<div class="clearfix"></div>
	<div class="errMsgCon" *ngIf="isError">
		<small>{{errMsg}}</small>
	</div>
	<div class="button-row clearfix">
    <button mat-raised-button *ngIf="poData.status != 'Completed'" id="add-inventory" (click)="addToInventory()" class="trea-btn">Add to inventory</button>
    <button mat-raised-button id="add-emp" routerLink="/inventory/rs/csa/receiving-slips-list/0" class="trea-btn">Cancel</button>
	</div>
	<form autocomplete="off" id="problemItemFm" role="form" [formGroup]="problemItemFm" *ngIf="poData && poData.problemItems">
		<div class="purchaseorderWrap" *ngIf="problem_items.controls.length > 0">
			<div class="clearfix"></div>
			<div class="ProblemitemsDetails">
				<div class="serPart text-center">
					<span>Problem Items</span>
				</div>
				<div class="table-responsive">
					<table class="table">
						<thead>
							<tr>
                                <th></th>
								<th>Manufacturer</th>
								<th>Item Definition</th>
								<th>Quantity</th>
								<th>Comment</th>
							</tr>
						</thead>
						<tbody>
							<tr *ngFor="let pItem of problem_items.controls; let indx=index" [formGroup]="pItem">
                                <td>
								<img class="img-responsive" src="assets/icon/close_icon.png" (click)="removeProblemItem(indx)">
							</td>
								<td>{{pItem.get('manufacturer').value}}</td>
								<td>{{pItem.get('manufacturerPart').value}}</td>
								<td>
                                    <div class="form-group">
                                        <input autocomplete="nope" type="number" formControlName="quantity" name="qtyReceived" class="txt-width PadR0" (keypress)="util.numberCheck($event)" (keyup)="util.removeCommas(pItem.get('quantity'))">
                                        <span class="error-msg" *ngIf="pItem.get('quantity').invalid && (pItem.get('quantity').dirty || pItem.get('quantity').touched || submitted)">
                                        <small *ngIf="pItem.get('quantity').errors.required">Quantity is required.</small>
                                        <small *ngIf="pItem.get('quantity').errors.pattern">Invalid Quantity.</small>
                                        </span>
                                    </div>
								</td>
								<td>
									<textarea class="form-control" formControlName="comment" placeholder="" rows="5"></textarea>
									<span class="error-msg" *ngIf="pItem.get('comment').invalid && (pItem.get('comment').dirty || pItem.get('comment').touched || submitted)">
										<small *ngIf="pItem.get('comment').errors.required">Comment is required.</small>
									</span>
								</td>
							</tr>
						</tbody>
					</table>
				</div>
				<div class="clearfix"></div>
				<div class="errMsgCon" *ngIf="isErrorPI">
                    <small>{{errMsgPI}}</small>
                </div>
				<div class="button-row clearfix">
          <button mat-raised-button id="send-supplier-btn" (click)="sendToSupplier(problemItemFm)" class="trea-btn">Send to supplier</button>
				</div>
			</div>
		</div>
	</form>
</div>
