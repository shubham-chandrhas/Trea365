
<div id="poMark"></div>
<div class="inventory-section purchaseorderreviewWrap" *ngIf="!editMode">
	<h3 class="pageTitle" *ngIf="!isExistingOrder">New Purchase Order Review</h3>
	<h3 class="pageTitle" *ngIf="isExistingOrder">Purchase Order {{pageData.purchase_order_no}} <span *ngIf="pageData.status && pageData.status != ''">({{pageData.status}})</span></h3>
	<div class="clearfix"></div>
	<div class="container-fluid">
		<div class="selSection">
			<div class="clearfix"></div>
			<div class="purchaseorderDetails">
				<div class="row">
					<div class="col-sm-6">
						<div class="row">
							<div class="col-sm-6">
								<div class="label-col">Date</div>
							</div>
							<div class="col-sm-6">
								<div class="info-col" *ngIf="!isExistingOrder">{{util.getFormatedDate(today)}}</div>
								<div class="info-col" *ngIf="isExistingOrder">{{util.getFormatedDate(pageData.purchase_order_date && pageData.purchase_order_date != '' ? pageData.purchase_order_date : today)}}</div>
							</div>
						</div>
						<div class="row">
							<div class="col-sm-6">
								<div class="label-col">Generated by</div>
							</div>
							<div class="col-sm-6">
								<div class="info-col">{{userInfo.first_name}}</div>
							</div>
						</div>
						<div class="row">
							<div class="col-sm-6">
								<div class="label-col">Supplier</div>
							</div>
							<div class="col-sm-6">
								<div class="info-col">{{pageData.supplierName}}</div>
							</div>
			            </div>
			            <!-- <div class="row" *ngIf="pageData.email_logs">
							<div class="col-sm-6">
								<div class="label-col">Email Status</div>
							</div>
							<div class="col-sm-6">
								<div class="info-col">Sent On {{util.getFormatedDate(pageData.email_logs.updated_at) }} to {{pageData.email_logs.email_to}}
			                  		<button *ngIf=" pageData.status != 'Cancelled' " mat-raised-button class="trea-btn" (click)="resendMail(pageData.email_logs, pageData.purchase_order_id)" id="resendEmail">Resend</button>
			                	</div>
							</div>
						</div> -->
					</div>
					<div class="col-sm-6" *ngIf="pageData.supplier">
						<!-- <div class="row">
							<div class="col-sm-6">
								<div class="label-col">Date</div>
							</div>
							<div class="col-sm-6">
								<div class="info-col" *ngIf="!isExistingOrder">{{util.getFormatedDate(today)}}</div>
								<div class="info-col" *ngIf="isExistingOrder">{{util.getFormatedDate(pageData.purchase_order_date)}}</div>
							</div>
                        </div> -->
                        <div class="row">
							<div class="col-sm-6">
								<div class="label-col">Phone</div>
							</div>
							<div class="col-sm-6">
								<div class="info-col">{{pageData.supplier.phone_no ? pageData.supplier.phone_no : 'N/A' }}</div>
							</div>
                        </div>
                        <div class="row">
							<div class="col-sm-6">
								<div class="label-col">Email</div>
							</div>
							<div class="col-sm-6">
								<div class="info-col">{{pageData.supplier.email_id ? pageData.supplier.email_id : 'N/A' }}</div>
							</div>
                        </div>
                        <div class="row">
							<div class="col-sm-6">
								<div class="label-col">Address</div>
							</div>
							<div class="col-sm-6">
								<div class="info-col">{{pageData.supplier.address1 ? util.concatenateStrings(pageData.supplier.address2,pageData.supplier.address1) : 'N/A' }}</div>
							</div>
                        </div>
                        
                        <div class="row" *ngIf="pageData.email_logs">
							<div class="col-sm-6">
								<div class="label-col">Date sent</div>
							</div>
							<div class="col-sm-6">
								<div class="info-col">{{util.getFormatedDate(pageData.email_logs.created_at)}}</div>
							</div>
                        </div>
                        

                        <div class="row" *ngIf="pageData.email_logs">
							<div class="col-sm-6">
								<div class="label-col">Sent by</div>
							</div>
							<div class="col-sm-6">
								<div class="info-col">{{userInfo.first_name}}</div>
							</div>
                        </div>
                        
					</div>
				</div>


				<div class="row" *ngIf="pageData.email_logs">
					<div class="col-sm-3">
						<div class="label-col">Email Status</div>
					</div>
					<div class="col-sm-6">
						<div class="info-col">Sent On {{util.getFormatedDate(pageData.email_logs.updated_at) }} to <span class="email">{{pageData.email_logs.email_to}}</span>
	                	</div>
	                	<button *ngIf=" pageData.status != 'Cancelled' " mat-raised-button class="trea-btn" (click)="resendMail(pageData.email_logs, pageData.purchase_order_id)" id="resendEmail">Resend</button>
					</div>
				</div>

			</div>
			<div class="clearfix"></div>
			<div class="purchaseitemDetails">
				<div class="serPart text-center">
					<span>Purchase Items</span>
				</div>
				<div class="table-responsive">
					<table class="table">
						<thead>
							<tr>
								<!-- <th>Item Category</th> -->
								<th>Manufacturer</th>
								<th>Item Definition</th>
								<th class="text-right">Qty Ordered (Units)</th>
								<th class="text-right">Price/Unit</th>
							</tr>
						</thead>
						<tbody>
							<tr *ngFor="let item of pageData.purchaseOrder.purchase_items; let indx=index">
								<!-- <td>{{item.itemClassName}}</td> -->
								<td *ngIf="item.isItemDelete == '0'">{{item.manf_name}}</td>
								<td *ngIf="item.isItemDelete == '0'">{{item.manf_part_name}}</td>
								<td *ngIf="item.isItemDelete == '0'" class="text-right">{{item.quantity}}</td>
								<td *ngIf="item.isItemDelete == '0'" class="text-right">
									{{item.unitPrice | currency: util.getCurrency() :'symbol-narrow'}}
								</td>
							</tr>
						</tbody>
						<tfoot>
							<tr>
								<!-- <td></td> -->
								<td></td>
								<td></td>
								<td class="text-right"><b>Cost of Order</b></td>
								<td class="text-right">
									{{pageData.costOfOrder | currency: util.getCurrency() :'symbol-narrow'}}
								</td>
							</tr>
						</tfoot>
					</table>
				</div>
			</div>
			<div class="clearfix"></div>
			<div class="commentDetails">
				<div class="row">
					<div class="col-sm-12">
						<div class="row">
							<div class="col-sm-2">
								<div class="label-col">Comment</div>
							</div>
							<div class="col-sm-10"> 
								<div class="info-col">{{pageData.purchaseOrder.comment ? pageData.purchaseOrder.comment : 'N/A'}}</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="clearfix"></div>
			<div class="paymentsDetails">
				<div class="matPart text-center">
					<span>Payment Schedule</span>
				</div>
				<div class="row">
					<div class="col-md-6">
						<div class="row">
							<div class="col-sm-7">
								<div class="label-col">Cost of Order</div>
							</div>
							<div class="col-sm-5">
								<div class="info-col text-right">
									{{pageData.costOfOrder | currency: util.getCurrency() :'symbol-narrow'}}
								</div>
							</div>
						</div>
						<div class="row">
							<div class="col-sm-7">
								<div class="label-col">Shipping and Handling</div>
							</div>
							<div class="col-sm-5">
								<div class="info-col text-right">
									{{pageData.purchaseOrder.shipAndHandling | currency: util.getCurrency() :'symbol-narrow'}}
								</div>
							</div>
						</div>
						<div class="row">
							<div class="col-sm-7">
								<div class="label-col">Adjustment</div>
							</div>
							<div class="col-sm-5">
								<div class="info-col text-right">
									{{pageData.purchaseOrder.adjustment | currency: util.getCurrency() :'symbol-narrow'}}
								</div>
							</div>
						</div>
						<div class="row">
							<div class="col-sm-7">
								<div class="label-col">&nbsp;</div>
							</div>
							<div class="col-sm-5">
								<div class="info-col">
									&nbsp;
								</div>
							</div>
						</div>
						<div class="row">
							<div class="col-sm-7">
								<div class="label-col"><b>Subtotal</b></div>
							</div>
							<div class="col-sm-5">
								<div class="info-col text-right">
									<b>{{pageData.subTotal | currency: util.getCurrency() :'symbol-narrow'}}</b>
								</div>
							</div>
						</div>
						<div class="row">
							<div class="col-sm-7">
								<div class="label-col"><b>Taxes {{pageData.purchaseOrder.tax}}%</b></div>
							</div>
							<div class="col-sm-5">
								<div class="info-col text-right">
									<b>{{pageData.taxes | currency: util.getCurrency() :'symbol-narrow'}}</b>
								</div>
							</div>
						</div>
						<div class="row">
							<div class="col-sm-7">
								<div class="label-col"><b>Total Cost</b></div>
							</div>
							<div class="col-sm-5">
								<div class="info-col text-right">
									<b>{{pageData.totalCost | currency: util.getCurrency() :'symbol-narrow'}}</b>
								</div>
							</div>
						</div>
					</div>
					<div class="col-md-6">
						<div class="table-responsive">
							<table class="table">
								<thead>
									<tr>
										<th>Date</th>
										<th class="text-right">Amount Due</th>
									</tr>
								</thead>
								<tbody>
									<tr *ngFor="let item of pageData.purchaseOrder.date_items; let indx=index">
										<td *ngIf="item.isScheduleDelete == '0'">{{util.getFormatedDate(util.stringToDate(item.paymentDate))}}</td>
										<td *ngIf="item.isScheduleDelete == '0'" class="text-right">
											{{item.paymentAmount | currency: util.getCurrency() :'symbol-narrow'}}
										</td>
									</tr>
								</tbody>
								<tfoot>
									<tr>
										<td><b>Total Payment Amount</b></td>
										<td class="text-right">
											{{pageData.totalPaymentAmount | currency: util.getCurrency() :'symbol-narrow'}}
										</td>
                                    </tr>
                                    <tr>
										<td><b>Remaining Amount</b></td>
										<td class="text-right">
											{{pageData.remainingPaymentAmount | currency: util.getCurrency() :'symbol-narrow'}}
										</td>
									</tr>
								</tfoot>
							</table>
						</div>
					</div>
				</div>

            </div>
      <div  class="paymentsDetails" *ngIf="isExistingOrder">
          <div class="serPart">
            <span>Paid Payments</span>
          </div>
          <div class="row">
            <div class="col-sm-6">
                <div class="table-responsive">
                    <table class="table">
                      <thead>
                        <tr>
                          <th>Payment Date</th>
                          <th class="text-right">Paid Amount</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let payment of pageData.paid_payments; let indx=index">
                          <td *ngIf="payment.isScheduleDelete == '0'">{{payment.payment_date | date: 'dd/MM/yyyy'}}</td>
                          <td *ngIf="payment.isScheduleDelete == '0'" class="text-right">
                            {{payment.payment_amount | currency: util.getCurrency() :'symbol-narrow'}}
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
            </div>
          </div>
        </div>
			<!-- <div class="clearfix"></div>
			<div class="PaymentDetails">
				<div class="row">
					<div class="col-sm-6">
						<div class="row">
							<div class="col-sm-6">
								<div class="label-col">Payment Method</div>
							</div>
							<div class="col-sm-6">
								<div class="info-col">Credit Card</div>
							</div>
						</div>
					</div>
				</div>
			</div> -->

			<div class="errMsgCon" *ngIf="totalPayErr">
	            <small>{{errMsg}}</small>
	          </div>
			<div class="clearfix"></div>

			<div class="button-row clearfix" *ngIf="!orderStatus">
                <button mat-raised-button (click)="editPurchaseOrder(pageData, 'backup')" class="trea-btn">Edit</button>
                <button mat-raised-button class="trea-btn" (click)="createPurchaseOrder(0)" id="addData">Save</button>
                <button mat-raised-button class="trea-btn" (click)="approvePOFromReview(pageData, '1')" id="approvePO">Approve</button>
                <button mat-raised-button class="trea-btn" (click)="sendOrderToSupplier(pageData, '1')" id="sendOrderToSupplier1">Send Order to Supplier</button>
                <button mat-raised-button (click)="cancel()" class="trea-btn">Cancel</button>
            </div>

			<div class="button-row clearfix" *ngIf="orderStatus == 'Saved'">
                <div>
                <button mat-raised-button (click)="editPurchaseOrder(pageData, '')" class="trea-btn">Edit</button>
                <!-- <button mat-raised-button class="trea-btn" (click)="sendOrderToSupplier(pageData, '2')" id="sendOrderToSupplier2">Send Order to Supplier</button> -->
                <button mat-raised-button class="trea-btn" (click)="approvePurchaseOrder(pageData)" id="approvePurchaseOrder">Approve</button>
                <button mat-raised-button  class="trea-btn" (click)="sendOrderToSupplier(pageData, '2')" id="sendOrderToSupplier2">Send Order to Supplier</button>
                <button mat-raised-button class="trea-btn" (click)="deletePurchaseOrder(pageData)" id="sendOrderToSupplier2">Delete</button>
                </div>
            </div>

            <div class="button-row clearfix" *ngIf="orderStatus == 'Partial'">
                <button mat-raised-button (click)="receiveItems(pageData)" class="trea-btn">Continue Receiving</button>
            </div>

            <div class="button-row clearfix" *ngIf="orderStatus == 'Received'">
                <button mat-raised-button *ngIf="util.getRole() == 2 || permissionsSet.createReceivingSlips" (click)="receiveItems(pageData)" class="trea-btn"><!-- Receive Items -->Create R/S</button> <!-- @Shahebaz (Create R/S)-->
            </div>

			<div class="button-row clearfix" *ngIf="orderStatus == 'Sent'">
        <button mat-raised-button *ngIf="util.getRole() == 2 || permissionsSet.createReceivingSlips" (click)="receiveItems(pageData)" class="trea-btn"><!-- Receive Items -->Create R/S</button> <!-- @Shahebaz (Create R/S)-->
        <button mat-raised-button class="trea-btn" (click)="approvePurchaseOrder(pageData)" id="approvePurchaseOrder">Approve</button>
        <button mat-raised-button *ngIf="!pageData.email_logs" class="trea-btn" (click)="sendOrderToSupplier(pageData, '2')" id="sendOrderToSupplier2">Send Order to Supplier</button>
        <button mat-raised-button *ngIf="util.getRole() == 2 || permissionsSet.cancelPurchaseOrder" class="trea-btn" (click)="cancelOrder(pageData)" id="cancelOrder">Cancel This Order</button>
      </div>


		</div>
	</div>
</div>
<div *ngIf="editMode">
	<app-new-purchase-order></app-new-purchase-order>
</div>










