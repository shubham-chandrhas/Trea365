<div class="newpurchaseOrderWrap">
    <h1 class="pageTitle" *ngIf="!editMode">New Purchase Order</h1>
    <h1 class="pageTitle" *ngIf="editMode">Purchase Order {{pageVariables.purchase_order_no}}</h1>

    <!-- <div class="container-fluid">
        <div class="selSection"> -->
    <form autocomplete="off" role="form" [formGroup]="addPurchaseOdrFm">
        <!-- <div class="generatequoteDetails"> -->
          <div class="row">
            <!-- <div class="col-sm-6">
							<div class="row">
								<div class="col-sm-6">
									<div class="label-col">Date</div>
                </div>
								<div class="col-sm-4">
                  <div class="info-col">{{util.getFormatedDate(today)}}</div>
								</div>
              </div>
              <div class="row">
								<div class="col-sm-6">
									<div class="label-col">Generated by</div>
								</div>
								<div class="col-sm-4">
									<div class="info-col">{{userInfo.first_name}}</div>
                </div>
              </div>
            </div> -->

            <div class="col-sm-6">
              <div class="row">
                <div class="col-sm-4">
                  <div class="label-col">Supplier</div>
                </div>
                <div class="col-sm-6">
                  <div class="form-group clearfix">
                    <div class="autoCompleteList">
                        <div class="searchList">
                          <mat-form-field class="product">
                            <input autocomplete="off" matInput placeholder=""  [formControl]="supplier" [matAutocomplete]="supplierAutoComp" (keyup)="validateSupplier($event)" id="supplierId" name="supplier{{autoNumber}}">
                            <i *ngIf="supplier.value!=''" (click)="util.clearAutoComplete('supplierId', [supplier, supplierId])" class="clearAutoComplete fa fa-times-circle" aria-hidden="true"></i>
                            <img *ngIf="supplier.value==''" class="selectBoxIcon" aria-hidden src="assets/icon/select.png" />
                            <mat-autocomplete #supplierAutoComp="matAutocomplete">
                                <mat-option *ngFor="let indx=index; let item of filteredSupplier | async | sortBy:'supplier_name':'ASC':'A'" [value]="item.supplier_name" (onSelectionChange)="getSelectedSupplier(item, $event)">
                                <span>{{ item.supplier_name }}</span>
                                </mat-option>

                                <mat-option (click)="showAddSupplierPopup()">
                                <img aria-hidden src="assets/icon/icon-add.png" />
                                <span>New Supplier</span>
                                </mat-option>
                            </mat-autocomplete>
                          </mat-form-field>

                          <div *ngIf="isSupplierLoad" class="loaderField"><i class="fa fa-spinner fa-pulse fa-3x fa-fw action"></i></div>
                        </div>
                    </div>
                    <!-- <select formControlName="supplierId" class="form-control">
                      <option *ngFor="let supplier of suppliersList" [value]="supplier.supplier_id">{{supplier.supplier_name}}</option>
                      <option value="New Supplier">New Supplier</option>
                    </select> -->
                    <span class="error-msg" *ngIf="supplierId.invalid && (supplierId.dirty || supplierId.touched || submitted || submittedSup)">
                        <small *ngIf="supplierId.errors.required">Please select Supplier from the list.</small>
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>
				<!-- </div> -->

          <h3 class="detailsHeading">Order Details</h3>
          <div class="purchaseitemDetails">
						<div class="table-responsive">
							<table class="table">
								<thead>
									<tr>
										<th><!-- Leave empty for alignment --></th>
										<!-- <th>Item Category</th> -->
										<th>Manufacturer</th>
										<th>Item Definition</th>
										<th>Order Qty (Units)</th>
										<th>Price/Unit</th>
									</tr>
								</thead>
								<tbody>
									<tr *ngFor="let item of purchase_items.controls; let indxP=index" [formGroup]="item">
										 <td *ngIf="item.get('isItemDelete').value == '0'"><img (click)="removeItem(indxP, item)" *ngIf="indxP != 0" src="assets/icon/close_icon.png"></td>
										<!--<td *ngIf="item.get('isItemDelete').value == '0'">
											<div class="form-group">
												<div class="autoCompleteList">
							                        <div class="searchList">
							                            <mat-form-field class="product">
							                                <input autocomplete="off" id=item_category_{{indxP}} matInput placeholder=""  [formControl]="item.get('itemClassName')" [matAutocomplete]="itemClassAutoComp" (keyup)="validateClass($event,item,indxP)" >
							                                <i *ngIf="item.get('itemClassName').value!=''" (click)="util.clearAutoComplete('item_category_', [item.get('itemClassName'), item.get('itemClassId'), item.get('manf_name'), item.get('manfId'), item.get('manf_part_name'), item.get('manfPartId')], indxP)" class="clearAutoComplete fa fa-times-circle" aria-hidden="true"></i>
                                							<img *ngIf="item.get('itemClassName').value==''" class="selectBoxIcon" aria-hidden src="assets/icon/select.png" />
							                                <mat-autocomplete #itemClassAutoComp="matAutocomplete">
							                                    <mat-option *ngFor="let indx=index; let mitem of item.get('filteredClass').value | async" [value]="mitem.item_class_name" (onSelectionChange)="getSelectedClass(mitem,$event,indxP)">
						                                        	<span>{{ mitem.item_class_name }}</span>
						                                        </mat-option>
							                                </mat-autocomplete>
							                            </mat-form-field>
							                        </div>
							                    </div>
												<span class="error-msg" *ngIf="item.get('itemClassId').invalid && (item.get('itemClassId').dirty || item.get('itemClassId').touched || submitted || submittedPartial)">
							                      	<small *ngIf="item.get('itemClassId').errors.required">Please select Category from the list.</small>
							                    </span>
											</div>
										</td> -->
										 <!-- && item.get('itemType').value != 'Material' -->
										<td *ngIf="item.get('isItemDelete').value == '0'">
											<div class="form-group" >
												<!-- *ngIf="item.get('itemType').value != 'Material'" -->
												<div class="autoCompleteList">
							                        <div class="searchList">
							                            <mat-form-field class="product">
							                                <input autocomplete="off" id=manf_name_{{indxP}} matInput placeholder="" [formControl]="item.get('manf_name')" [matAutocomplete]="manufacturerAutoComp" (keyup)="validateManf($event,item,indxP)">
							                                <i *ngIf="item.get('manf_name').value!=''" (click)="util.clearAutoComplete('manf_name_', [item.get('manf_name'), item.get('manfId'), item.get('manf_part_name'), item.get('manfPartId'), item.get('filteredManufacturerPart')], indxP)" class="clearAutoComplete fa fa-times-circle" aria-hidden="true"></i>
                                							<img *ngIf="item.get('manf_name').value==''" class="selectBoxIcon" aria-hidden src="assets/icon/select.png" />
							                                <mat-autocomplete #manufacturerAutoComp="matAutocomplete">
							                                    <mat-option *ngFor="let indx=index; let mitem of item.get('filteredManufacturer').value | async | sortBy:'manf_name':'ASC':'A'" [value]="mitem.manf_name" (onSelectionChange)="getMfg(mitem,$event,indxP)">
							                                    <span>{{ mitem.manf_name }}</span>
							                                    </mat-option>

							                                    <mat-option (click)="showAddManufacturerPopup(indxP)">
							                                    <img aria-hidden src="assets/icon/icon-add.png" />
							                                    <span>New Manufacturer</span>
							                                    </mat-option>
							                                </mat-autocomplete>
							                            </mat-form-field>
							                        </div>
							                    </div>
							                    <!-- <select *ngIf="item.get('itemType').value == 'Material'" class="form-control autoSelectAlternate">
													<option value="{{pageData.defaultManfId}}">{{pageData.defaultManfName}}</option>
												</select> -->
												<span class="error-msg" *ngIf="item.get('manfId').invalid && (item.get('manfId').dirty || item.get('manfId').touched || submitted || submittedPartial)">
							                      	<small *ngIf="item.get('manfId').errors.required">Please select Manufacture from the list.</small>
							                    </span>
											</div>
										</td>
										<!-- [colSpan]="item.get('itemType').value == 'Material' ? 2 : 1" -->
										<td *ngIf="item.get('isItemDelete').value == '0'" >
											<div class="form-group">
												<div class="autoCompleteList">
							                        <div class="searchList">
							                            <mat-form-field class="product">
							                                <input autocomplete="off" id=manf_part_name_{{indxP}} matInput placeholder=""  [formControl]="item.get('manf_part_name')" [matAutocomplete]="manufacturerPartAutoComp" (keyup)="validateManfPart($event,item,indxP)">
							                                <i *ngIf="item.get('manf_name').value!=''" (click)="util.clearAutoComplete('manf_part_name_', [item.get('manf_part_name'), item.get('manfPartId')], indxP)" class="clearAutoComplete fa fa-times-circle" aria-hidden="true"></i>
                                							<img *ngIf="item.get('manf_part_name').value==''" class="selectBoxIcon" aria-hidden src="assets/icon/select.png" />
							                                <mat-autocomplete #manufacturerPartAutoComp="matAutocomplete">
							                                    <mat-option *ngFor="let indx=index; let mitem of item.get('filteredManufacturerPart').value | async | sortBy:'short_name':'ASC':'A'" [value]="mitem.short_name" (onSelectionChange)="getManfPart(mitem, $event, indxP)">
							                                    <span>{{ mitem.short_name }}</span>
							                                    </mat-option>

							                                    <mat-option *ngIf="item.get('manf_name').value!=''" (click)="showAddManufacturerPartPopup(indxP)">
							                                    <img aria-hidden src="assets/icon/icon-add.png" />
							                                    <span>New Item Definition</span>
							                                    </mat-option>
							                                </mat-autocomplete>
							                            </mat-form-field>
							                        </div>
							                    </div>
												<span class="error-msg" *ngIf="item.get('manfPartId').invalid && (item.get('manfPartId').dirty || item.get('manfPartId').touched || submitted || submittedPartial)">
							                      	<small *ngIf="item.get('manfPartId').errors.required">Please select Item Defination from the list.</small>
							                    </span>
											</div>
										</td>
										<td *ngIf="item.get('isItemDelete').value == '0'">
											<div class="form-group">
												<input autocomplete="nope" type="number" formControlName="quantity" class="form-control PadR0" (keypress)="util.moneyCheck($event)" (change)="calculateCostOfOrder()" >
												<span class="error-msg" *ngIf="item.get('quantity').invalid && (item.get('quantity').dirty || item.get('quantity').touched || submitted || submittedPartial)">
													  <small *ngIf="item.get('quantity').errors.required">Quantity is required.</small>
													  <small *ngIf="item.get('quantity').errors.pattern">Invalid Quantity.</small>
							                    </span>
											</div>
										</td>
										<td *ngIf="item.get('isItemDelete').value == '0'">
											<div class="form-group">
												<input autocomplete="nope" type="text" formControlName="unitPrice" placeholder="" class="form-control" (keyup)="calculateCostOfOrder()">
												<span class="error-msg" *ngIf="item.get('unitPrice').invalid && (item.get('unitPrice').dirty || item.get('unitPrice').touched || submitted || submittedPartial)">
													  <small *ngIf="item.get('unitPrice').errors.required">Price/Unit is required.</small>
													  <small *ngIf="item.get('unitPrice').errors.pattern && !item.get('unitPrice').errors.maxlength">Invalid Price.</small>
							                    </span>
											</div>
										</td>
                  </tr>
                  <tr>
                    <td><!-- Leave empty for alignment --></td>
                    <td colspan=5>
                      <span (click)="addPurchaseItem('0')" class="addMore">
                        <img src="assets/icon/icon-16.png" class="img-responsive" alt="Add Items">
                        <span>Add Item</span>
                      </span>
                    </td>
                  </tr>
								</tbody>
							</table>
						</div>
          </div>


            <h3 class="detailsHeading">Payment Details</h3>

            <h4 class="detailsHeading">Costs</h4>
            <div class="costWrap">
                <div class="row">
                    <div class="col-sm-6">
                        <div class="label-col">Cost of Order</div>
                    </div>
                    <div class="col-sm-6">
                        <div class="info-col">{{pageVariables.costOfOrder | currency: util.getCurrency() :'symbol-narrow'}}</div>
                    </div>
                </div>
                <div class="row">
                  <div class="col-sm-6">
                    <div class="label-col">Shipping & Handling</div>
                    </div>
                    <div class="col-sm-6">
                        <div class="info-col">
                          <div class="form-group">
                            <!-- (keypress)="util.numberCheck($event)" -->
                              <input autocomplete="nope" type="text" formControlName="shipAndHandling" class="form-control" (keyup)="calculateCostOfOrder()" />
                              <span class="error-msg" *ngIf="shipAndHandling.invalid && (shipAndHandling.dirty || shipAndHandling.touched || submitted)">
                                <small *ngIf="shipAndHandling.errors.required">Shipping and Handling is required.</small>
                                  <small *ngIf="shipAndHandling.errors.pattern">Invalid Amount (e.g 54, 78.25).</small>
                                </span>
                              </div>
                        </div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-sm-6">
                      <div class="label-col">Adjustment (+/-)</div>
                    </div>
                    <div class="col-sm-6">
                      <div class="info-col">
                        <div class="form-group">
                          <!--  (keyup)="calculateCostOfOrder()" -->
                          <input autocomplete="nope" type="text" formControlName="adjustment" class="form-control" (keyup)="calculateCostOfOrder()" />
                          <span class="error-msg" *ngIf="adjustment.invalid && (adjustment.dirty || adjustment.touched || submitted)">
                            <small *ngIf="adjustment.errors.required">Adjustment is required.</small>
                            <small *ngIf="adjustment.errors.pattern">Invalid Amount (e.g 54, 78.25).</small>
                          </span>
                        </div>
                      </div>
                    </div>
                  </div>
                <div class="row">
                    <div class="col-sm-6">
                        <div class="label-col"><strong>Subtotal</strong></div>
                    </div>
                    <div class="col-sm-6">
                        <div class="info-col"><strong>{{pageVariables.subTotal | currency: util.getCurrency() :'symbol-narrow'}}</strong></div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-6">
                        <div class="label-col form-group">Taxes
                            <input autocomplete="nope" type="text" formControlName="tax" class="taxInput" (keyup)="calculateTaxes()" />
                            <span>%</span>
                            <span class="error-msg" *ngIf="tax.invalid && (tax.dirty || tax.touched || submitted)">
                                <!-- <small *ngIf="tax.errors.required">Tax is required.</small> -->
                                <small *ngIf="tax.errors.min || tax.errors.max || tax.errors.pattern">Invalid Taxes.</small>
                              <!-- <small *ngIf="(tax.errors.min || tax.errors.max) && !tax.errors.pattern">Invalid Taxes.</small>
                              <small *ngIf="tax.errors.pattern">Invalid Amount (e.g 54, 78.25).</small> -->
                            </span>
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="info-col">
                            {{pageVariables.taxes | currency: util.getCurrency() :'symbol-narrow'}}
                          </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-6">
                        <div class="label-col"><strong>Total Cost</strong></div>
                    </div>
                    <div class="col-sm-6">
                        <div class="info-col">
                            <strong>{{pageVariables.totalCost | currency: util.getCurrency() :'symbol-narrow'}}</strong>
                        </div>
                    </div>
                </div>
            </div>

            <h4 class="detailsHeading">Payment Schedule</h4>
            <div class="paymentSchedWrap MT20">
                  <div class="table-responsive">
                      <table class="table">
                          <thead>
                              <tr>
                                  <th><!-- Leave empty for alignment --></th>
                                  <th>Payment Date</th>
                                  <th>Amount Due</th>
                              </tr>
                          </thead>
                          <tbody>
                            <tr *ngFor="let date of date_items.controls; let indx=index" [formGroup]="date">
                              <td *ngIf="date.get('isScheduleDelete').value == '0'">
                                <span class="closeIcon" *ngIf="indx != 0"><img (click)="removeDate(indx, date)" src="assets/icon/close_icon.png"></span>
                              </td>
                              <td *ngIf="date.get('isScheduleDelete').value == '0'">
                                <div class="form-group">
                                  <div class="dateWrapper">
                                      <!-- [min]="minDate"> -->
                                      <input autocomplete="nope" type="text"  formControlName="paymentDate" class="date" [matDatepicker]="picker" style="pointer-events: none;" readonly="true">
                                      <!-- [min]="minDate" -->
                                      <!-- (selectedChanged)="updatePaymentDate($event,indx)" -->
                                      <mat-datepicker #picker ></mat-datepicker>
                                      <span class="dateIcon" (click)="picker.open()"><img src="assets/icon/date_picker.png"></span>
                                      <div class="clearfix"></div>
                                      <span class="error-msg" *ngIf="date.get('paymentDate').invalid && (date.get('paymentDate').dirty || date.get('paymentDate').touched || submitted || submittedPartialDate)">
                                        <small *ngIf="date.get('paymentDate').errors.required">Date is required.</small>
                                        <small *ngIf="date.get('paymentDate').errors.min">Please enter upcoming date.</small>
									                    </span>
                                  </div>
                                </div>
                              </td>
                              <td *ngIf="date.get('isScheduleDelete').value == '0'">
                                <div class="form-group">
                                    <input autocomplete="nope" type="text" formControlName="paymentAmount" name="amountDue" placeholder="" class="form-control" (keyup)="calculatePaymentAmount()">
                                    <span class="error-msg" *ngIf="date.get('paymentAmount').invalid && (date.get('paymentAmount').dirty || date.get('paymentAmount').touched || submitted || submittedPartialDate)">
                                      <small *ngIf="date.get('paymentAmount').errors.required">Amount Due is required.</small>
                                      <small *ngIf="date.get('paymentAmount').errors.pattern">Invalid Amount (e.g 54, 78.25).</small>
                                    </span>
                                </div>
                              </td>
                            </tr>
                            <tr>
                              <td><!-- Leave empty for alignment --></td>
                              <td colspan=2>
                                  <div class="morePayDates">
                                      <span (click)="addDateItem('0')" class="addMore">
                                        <img src="assets/icon/icon-16.png" class="img-responsive" alt="Add Items">
                                        <span>Add Payment Date</span>
                                      </span>
                                  </div>
                              </td>
                            </tr>
                          </tbody>
                          <tfoot>
                            <tr>
                                <td><!-- Leave empty for alignment --></td>
                                <td>
                                  <div class="label-col big-total">Total Payment Amount</div>
                                  <div class="label-col remaining">Remaining Amount</div>
                                </td>
                                <td>
                                  <div class="info-col big-total">
                                    <strong>{{pageVariables.totalPaymentAmount | currency: util.getCurrency() :'symbol-narrow'}}</strong>
                                  </div>
                                  <div class="info-col">
                                    <span class="remaining">{{pageVariables.remainingPaymentAmount | currency: util.getCurrency() :'symbol-narrow'}}</span>
                                  </div>
                                </td>
                            </tr>
                          </tfoot>
                      </table>
                  </div>
            </div>

            <div class="row MT20">
              <div class="form-group">
                <div class="col-md-2">
                  <label class="label-col" for="comment">Comment</label>
                </div>
                <div class="col-md-6">
                  <textarea autocomplete="nope" class="form-control" formControlName="comment" placeholder="(optional)" rows="6"></textarea>
                  <span class="error-msg" *ngIf="comment.invalid && (comment.dirty || comment.touched || submitted)">
                    <small *ngIf="comment.errors.maxlength">Comment must not be longer than {{constant.DEFAULT_COMMENT_MAXLENGTH}} characters.</small>
                  </span>
                </div>
            </div>
            <div class="clearfix"></div>


            <div class="errMsgCon" *ngIf="isError" style="margin-bottom: 20px;">
              <small>{{errMsg}}</small>
            </div>

            <div class="button-row" *ngIf="!editMode">
              <button mat-raised-button id="savePO" class="trea-btn" (click)="createPurchaseOrder(addPurchaseOdrFm,'1')">Save</button>
              <button mat-raised-button id="add-emp" (click)="reviewOrder(addPurchaseOdrFm)" class="trea-btn">Next</button>
              <button mat-raised-button (click)="cancel('1')" class="trea-btn">Cancel</button>
            </div>
            <div class="button-row" *ngIf="editMode">
              <button mat-raised-button id="saveExsisting" (click)="createPurchaseOrder(addPurchaseOdrFm,'2')" class="trea-btn">Save</button>
              <button mat-raised-button id="add-emp" (click)="reviewOrder(addPurchaseOdrFm)" class="trea-btn">Next</button>
              <!-- <button mat-raised-button id="saveExsisting" (click)="saveOrder(addPurchaseOdrFm)" class="trea-btn">Save</button> -->
              <button mat-raised-button (click)="cancel('2')" class="trea-btn">Cancel</button>
            </div>

				</div>
			</form>
		<!-- </div>
    </div> -->
</div>
