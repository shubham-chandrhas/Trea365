
<div class="qutationreviewWrap">
	<h1 class="pageTitle">Quotation Information Review</h1>

	<div class="selSection">
		<div class="quotationreviewDetails">
			<!-- <div class="timeWrap">
				<div class="row">
					<div class="form-group"> -->
						<!-- [ngClass]="formAction == 'edit' ? 'ptrN' : ''" -->
						<!-- <div class="col-sm-4">
							<select [(ngModel)]="versionlist" class="form-control" (ngModelChange)="setVersion(versionlist)">
								<option *ngIf="versions.length==0" value="0">Latest</option>
								<option  *ngFor="let version  of versions; index as i " value="{{i}}">
									<span *ngIf="i!='0'">
										{{version ? (version.created_at | date:'dd/MM/yyyy h:mm a'):'N/A'}} {{version ? version.generated_by.first_name:''}}
									</span>
									<span *ngIf="i=='0'">
											Latest
										</span>
								</option>
							</select>
						</div>
					</div>
				</div> -->
				<!-- <div class="row">
					<div class="col-sm-6">
						<div class="label-col">Date</div>
					</div>
					<div class="col-sm-6">
						<div class="info-col">{{util.getFormatedDate(quotationDetails.today)}}</div>
					</div>
				</div>
				<div class="row">
					<div class="col-sm-6">
						<div class="label-col">Generated by</div>
					</div>
					<div class="col-sm-6">
						<div class="info-col">{{quotationDetails.generatedBy}}</div>
					</div>
				</div> -->
			<!-- </div> -->


		<!-- <div class="servicesDetails" *ngIf="versions && versions.length > 1">
				<div class="subTitle">
					<span>Version Log</span>
				</div>
				<div class="table-responsive">
					<table class="table">
						<thead>
							<tr>
								<th>Managed By</th>
								<th>Status</th>
								<th>Date</th>
								<th>Time</th>
								<th>Notes</th>
							</tr>
						</thead>
						<tbody>
							<tr *ngFor="let version; let indx = index; of versions">
									<td *ngIf="indx!=0">{{version.generated_by.first_name}}  {{version.generated_by.last_name}}</td>
									<td *ngIf="indx!=0">{{version.status_details.status}}</td>
									<td *ngIf="indx!=0">{{util.getFormatedDate(version.created_at)}}</td>
									<td *ngIf="indx!=0">{{version.created_at | date:'hh:mm a'}}</td>
									<td *ngIf="indx!=0">NA</td>
							</tr>
							<tr *ngIf="versions && versions.length <= 1">
									<td colspan="5" class="text-center">No Vesion available for Quatiotion.</td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
			<div class="clearfix"></div> -->

			<h3 class="detailsHeading">Client</h3>
			<div class="row">
				<div class="col-sm-6">
					<div class="row">
						<div class="col-sm-4">
							<div class="label-col">Client Name</div>
						</div>
						<div class="col-sm-8">
							<div class="info-col">{{quotationDetails.clientDetails.client_name}}</div>
						</div>
					</div>
					<div class="row">
						<div class="col-sm-4">
							<div class="label-col">Work Location</div>
						</div>
						<div class="col-sm-8">
							<div class="info-col">{{quotationDetails.clientDetails.location}}</div>
						</div>
					</div>
					<div class="row">
						<div class="col-sm-4">
							<div class="label-col">Billing Address</div>
						</div>
						<div class="col-sm-8">
							<div class="info-col">{{quotationDetails.clientDetails.client_billing_location}}</div>
						</div>
					</div>
					<!-- <div class="row" *ngIf="!quotationStatus">
						<div class="col-sm-4">
							<div class="label-col">Quotation Status</div>
						</div>
						<div class="col-sm-8">
							<div class="info-col">
								<span class="green-text" *ngIf="quotationStatus">Complete</span>
								<span class="red-text" *ngIf="!quotationStatus">Incomplete</span>
							</div>
						</div>
					</div> -->
					<!-- <div class="row" *ngIf="!quotationStatus">
						<div class="col-sm-4">
							<div class="label-col">Status Details</div>
						</div>
						<div class="col-sm-8">
							<div class="row">
								<div class="col-sm-8">
									<div class="info-col">
										<div class="text-right">At least one Service or Product or Material</div>
									</div>
								</div>
								<div class="col-sm-4">
									<div class="info-col">
										<span class="green-text" *ngIf="serviceMaterialStatus">Complete</span>
										<span class="red-text" *ngIf="!serviceMaterialStatus">Incomplete</span>
									</div>
								</div>
							</div>
							<div class="row">
								<div class="col-sm-8">
									<div class="info-col">
										<div class="text-right">Schedule of Work</div>
									</div>
								</div>
								<div class="col-sm-4">
									<div class="info-col">
										<span class="green-text" *ngIf="scheduleStatus">Complete</span>
										<span class="red-text" *ngIf="!scheduleStatus">Incomplete</span>
									</div>
								</div>
							</div>
							<!-- @@ Commented code by Yogesh for remove validation  -->
							<!-- <div class="row">
								<div class="col-sm-8">
									<div class="info-col">
										<div class="text-right">Payment Schedule</div>
									</div>
								</div>
								<div class="col-sm-4">
									<div class="info-col">
										<span class="green-text" *ngIf="paymentScheduleStatus">Complete</span>
										<span class="red-text" *ngIf="!paymentScheduleStatus">Incomplete</span>
									</div>
								</div>
							</div> -->
						<!-- </div>
					</div> -->
				</div>
				<div class="col-sm-6">
					<div class="row">
						<div class="col-sm-4">
							<div class="label-col">Contact</div>
						</div>
						<div class="col-sm-8">
							<div class="info-col">{{quotationDetails.clientDetails.contact_name}}</div>
						</div>
					</div>
					<div class="row">
						<div class="col-sm-4">
							<div class="label-col">Email</div>
						</div>
						<div class="col-sm-8">
							<div class="info-col">{{quotationDetails.clientDetails.email}}</div>
						</div>
					</div>
					<div class="row">
						<div class="col-sm-4">
							<div class="label-col">Phone Number</div>
						</div>
						<div class="col-sm-8">
							<div class="info-col">{{util.maskPhoneNumber(quotationDetails.clientDetails.phoneNo)}}</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="clearfix"></div>

        <div class="scheduleDetails" *ngIf="scheduleWithoutDetails">
                <h3 class="detailsHeading">Schedule </h3>
                <span>Not Known</span>
        </div>
		<div class="scheduleDetails" *ngIf="quotationDetails.scheduleDetails">
			<h3 class="detailsHeading">Schedule</h3>
			<div class="row">
				<div class="col-sm-6">
					<div class="row">
						<div class="col-sm-4">
							<div class="label-col">Start Date</div>
						</div>
						<div class="col-sm-8">
							<div class="info-col">{{util.getFormatedDate(quotationDetails.scheduleDetails.start_date)}}</div>
						</div>
					</div>
					<div class="row">
						<div class="col-sm-4">
							<div class="label-col">Start Time</div>
						</div>
						<div class="col-sm-8">
							<div class="info-col">{{quotationDetails.scheduleDetails.start_time}} {{quotationDetails.scheduleDetails.start_time_format}}</div>
						</div>
					</div>
					<div class="row">
						<div class="col-sm-4">
							<div class="label-col">End Date</div>
						</div>
						<div class="col-sm-8">
							<div class="info-col">{{util.getFormatedDate(quotationDetails.scheduleDetails.end_date)}}</div>
						</div>
					</div>
					<div class="row">
						<div class="col-sm-4">
							<div class="label-col">End Time</div>
						</div>
						<div class="col-sm-8">
							<div class="info-col">{{quotationDetails.scheduleDetails.end_time}} {{quotationDetails.scheduleDetails.end_time_format}}</div>
						</div>
					</div>
				</div>
				<!-- <div class="col-sm-6">
					<div class="row">
						<div class="col-sm-4">
							<div class="label-col">Repeat</div>
						</div>
						<div class="col-sm-8">
							<div class="info-col">{{quotationDetails.scheduleDetails.schedule_repeat_name ? quotationDetails.scheduleDetails.schedule_repeat_name: 'N/A'  }}</div>
							<div class="info-col">{{quotationDetails.scheduleDetails.schedule_days}}</div>
						</div>
					</div>
				</div> -->
			</div>
			<!-- <div class="table-responsive">
				<table class="table">
				<thead>
					<tr>
						<th>Start Date</th>
						<th>Start Time</th>
						<th>End Date</th>
						<th>End Time</th>
						<th *ngIf="quotationDetails.scheduleDetails && quotationDetails.scheduleDetails.schedule_type != 2">Repeat On</th>
					</tr>
				</thead>
				<tbody>
					<tr *ngIf="quotationDetails.scheduleDetails && quotationDetails.scheduleDetails.start_date">
						<td>{{util.getFormatedDate(quotationDetails.scheduleDetails.start_date)}}</td>
						<td>{{quotationDetails.scheduleDetails.start_time}} {{quotationDetails.scheduleDetails.start_time_format}}.</td>
						<td>{{util.getFormatedDate(quotationDetails.scheduleDetails.end_date)}}</td>
						<td>{{quotationDetails.scheduleDetails.end_time}} {{quotationDetails.scheduleDetails.end_time_format}}.</td>
						<td *ngIf="quotationDetails.scheduleDetails && quotationDetails.scheduleDetails.schedule_type != 2">N/A</td>
					</tr>
					<tr>
						<td colspan="5"></td>
					</tr>
				</tbody>
			</table>
			</div>
			<div class="scheduleDetailsnext" *ngIf="quotationDetails.scheduleDetails && quotationDetails.scheduleDetails.schedule_type == 2">
				<table class="table">
				<thead>
					<tr>
						<th>Repeat</th>
						<th>Repeat On</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td>{{quotationDetails.scheduleDetails.schedule_repeat_name ? quotationDetails.scheduleDetails.schedule_repeat_name:quotationDetails.scheduleDetails.schedule_repeat_details.status  }}</td>
						<td>{{quotationDetails.scheduleDetails.schedule_days}}</td>
					</tr>
				</tbody>
			</table>
			</div> -->
		</div>
		<div class="inspectionDetails" *ngIf="quotationDetails.siteInspection">
			<h4 class="detailsHeading">Site Inspection</h4>
			<div class="row infoWrap">
				<div class="col-sm-8">
					<div class="row">
						<div class="col-sm-6">
							<div class="label-col">Date</div>
						</div>
						<div class="col-sm-6">
							<div class="info-col">{{util.getFormatedDate(quotationDetails.siteInspection.inspection_date)}}</div>
						</div>
					</div>
					<div class="row">
						<div class="col-sm-6">
							<div class="label-col">Time</div>
						</div>
						<div class="col-sm-6">
							<div class="info-col">{{quotationDetails.siteInspection.start_time}} {{quotationDetails.siteInspection.start_time_format}}-{{quotationDetails.siteInspection.end_time}} {{quotationDetails.siteInspection.end_time_format}}</div>
						</div>
					</div>
					<div class="row">
						<div class="col-sm-6">
							<div class="label-col">Inspector</div>
						</div>
						<div class="col-sm-6">
							<div class="info-col">{{quotationDetails.siteInspection.inspector_name}}</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="clearfix"></div>

		<div class="reqDescWrap">
			<h3 class="detailsHeading">Requirements</h3>
			<div class="description">
					{{quotationDetails.clientDetails.requirements}}
			</div>
			<div class="row" *ngIf="quotationDetails.images">
				<div class="col-sm-3" *ngFor="let indx=index; let item of quotationDetails.images;">
					<div class="previewImg">
						<img [src]="item.attachment_path" class="img-responsive" />
					</div>
				</div>
			</div>
		</div>
		<div class="clearfix"></div>


		<div class="servicesDetails" *ngIf="quotationDetails.servicesDetails.services.length > 0">
				<!-- <h4 class="detailsHeading">Services</h4> -->
			<div class="table-responsive">
				<table class="table">
					<thead>
						<tr>
							<th>Service</th>
							<th class="text-right">Cost</th>
							<th class="text-right">Quantity</th>
							<th class="text-right">Amount</th>
							<th >Details</th>
						</tr>
					</thead>
					<tbody>
						<tr *ngFor="let service of quotationDetails.servicesDetails.services">
							<td>{{service.service_definition}}</td>
							<td class="text-right">{{service.cost | currency: util.getCurrency() :'symbol-narrow'}}</td>
							<td class="text-right">{{service.quantity | number: "1.2-2"}}</td>
							<td class="text-right">{{service.total_amount | currency: util.getCurrency() :'symbol-narrow'}}</td>
							<td >{{service.details}}</td>
						</tr>
						<!-- <tr *ngIf="quotationDetails.servicesDetails.services.length==0">
								<td colspan="5" class="text-center">No Services Available.</td>
						</tr> -->
					</tbody>
					<tfoot>
						<tr>
							<td colspan=3 style="text-align: right">
								<span style="padding-right:1em;">Services Subtotal</span>
							</td>
							<td class="text-right">
								<span *ngIf="quotationDetails.servicesDetails.services.length > 0">{{quotationDetails.paymentScheduleDetails.cost_of_service | currency: util.getCurrency() :'symbol-narrow'}}</span>
              </td>
                  <!-- @mohini start - do not remove this blank td for proper alignment -->
              <td></td>
                  <!-- @mohini end - do not remove this blank td for proper alignment -->

						</tr>
					</tfoot>
				</table>
				<!-- <div class="text-center tfooter" *ngIf="quotationDetails.servicesDetails.services.length > 0" >
					<span>Total Amount for Services </span> <span> {{quotationDetails.servicesDetails.services_amount | currency: util.getCurrency() :'symbol-narrow'}}</span>
				</div> -->
			</div>
		</div>
		<div class="clearfix"></div>

		<div class="materialsDetails" *ngIf="quotationDetails.materialsDetails.materials.length > 0">
				<!-- <h4 class="detailsHeading">Products / Materials</h4> -->
			<div class="table-responsive">
				<table class="table">
					<thead>
						<tr>
							<th>Product / Material</th>
							<th class="text-right">Cost</th>
							<th class="text-right">Quantity</th>
							<th class="text-right">Amount</th>
							<!-- <th>Details</th> -->
						</tr>
					</thead>
					<tbody>
						<tr *ngFor="let material of quotationDetails.materialsDetails.materials">
							<td>{{material.short_name}}</td>
							<td class="text-right">{{material.cost | currency: util.getCurrency() :'symbol-narrow'}}</td>
							<td class="text-right">{{material.quantity | number: "1.2-2"}} {{material.uom}}</td>
							<td class="text-right">{{material.total_amount | currency: util.getCurrency() :'symbol-narrow'}}</td>
							<!-- <td>{{material.details}}</td> -->
						</tr>
						<!-- <tr *ngIf="quotationDetails.materialsDetails.materials.length == 0">
							<td colspan="5" class="text-center">No Materials Available.</td>
						</tr> -->
					</tbody>
					<tfoot>
						<tr>
							<td colspan=3 style="text-align: right">
								<span style="padding-right:1em;">Products & Materials Subtotal</span>
							</td>
							<td class="text-right">
									<span *ngIf="quotationDetails.materialsDetails.materials.length > 0"> {{quotationDetails.paymentScheduleDetails.cost_of_material | currency: util.getCurrency() :'symbol-narrow'}}</span>
							</td>
							<!-- <td></td> -->
						</tr>
					</tfoot>
				</table>
			</div>
		</div>
		<div class="clearfix"></div>

		<div class="paymentsDetails">
			<div class="costCalculate">
				<div class="row">



                    <div class="col-sm-6">
                            <h3 class="detailsHeading">Payment Schedule:
                               <span class="font-normal"   *ngIf="quotationDetails.paymentScheduleDetails.scheduleType == 'due'">
                                 Net {{quotationDetails.paymentScheduleDetails.paymentTerm}} days </span></h3>
        <div class="form-group cutom-margin-top" *ngIf="quotationDetails.paymentScheduleDetails.scheduleType == 'custom'">

						<h4 class="detailsHeading">Payment Schedule:</h4>
						<div class="table-responsive">
							<table class="table">
								<thead>
									<tr>
										<th>Date</th>
										<th class="text-right">Amount Due</th>
									</tr>
								</thead>
								<tbody>
									<tr *ngFor="let item of quotationDetails.paymentScheduleDetails.date_items">
										<td>{{util.getFormatedDate(item.payment_date)}}</td>
										<td class="text-right">{{item.amount_due | currency: util.getCurrency() :'symbol-narrow'}}</td>
									</tr>
								</tbody>
								<tfoot>

									<tr>
										<td><div class="label-col" style="padding-right:1em;">Total Amount Scheduled</div></td>
										<td class="text-right"><strong>{{totalScheduledPay | currency: util.getCurrency() :'symbol-narrow'}}</strong></td>
									</tr>
									<!-- <tr>
										<td><div class="label-col" style="padding-right:1em;">Total Amount Due</div></td>
										<td class="text-right"><strong>{{quotationDetails.paymentScheduleDetails.total_cost | currency: util.getCurrency() :'symbol-narrow'}}</strong></td>
									</tr> -->
									<tr *ngIf="remainingPayment > 0">
										<td><div class="label-col" style="padding-right:1em;">Remaining Amount</div></td>
										<td class="text-right"><strong>{{remainingPayment | currency: util.getCurrency() :'symbol-narrow'}}</strong></td>
									</tr>

								</tfoot>
							</table>
						</div>
						</div>
                    </div>
                    <div class="col-sm-6">
			<h3 class="detailsHeading">Fees</h3>

                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="label-col">Cost of Services </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="info-col text-right">{{quotationDetails.paymentScheduleDetails.cost_of_service | currency: util.getCurrency() :'symbol-narrow'}}</div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="label-col">Cost of Materials</div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="info-col text-right">{{quotationDetails.paymentScheduleDetails.cost_of_material | currency: util.getCurrency() :'symbol-narrow'}}</div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="label-col">
                                        <div class="text-rigth">Subtotal</div>
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="info-col text-right"><strong>{{quotationDetails.paymentScheduleDetails.subtotal | currency: util.getCurrency() :'symbol-narrow'}}</strong></div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="label-col">Shipping & Handling</div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="info-col text-right">{{quotationDetails.paymentScheduleDetails.shipping_handling | currency: util.getCurrency() :'symbol-narrow'}}</div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="label-col">Adjustment (+/-)</div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="info-col text-right">{{quotationDetails.paymentScheduleDetails.adjustment | currency: util.getCurrency() :'symbol-narrow'}}</div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="label-col">Taxes <span> {{quotationDetails.paymentScheduleDetails.taxes}}%</span></div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="info-col text-right">{{quotationDetails.paymentScheduleDetails.tax_amount | currency: util.getCurrency() :'symbol-narrow'}}</div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="label-col">
                                        <div class="text-rigth">Total Ammount Due</div>
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <!-- @ dev-v2 Start-->
                                    <!-- <div class="label-col">
                                        <div class="text-left">{{quotationDetails.paymentScheduleDetails.total_cost | currency: util.getCurrency() :'symbol-narrow'}}</div>
                                    </div> -->
                                    <!-- @ dev-v2 End-->
                                    <!-- @ UI-improvements Start -->
                                    <div class="info-col text-right"><strong>{{quotationDetails.paymentScheduleDetails.total_cost | currency: util.getCurrency() :'symbol-narrow'}}</strong></div>
                                    <!-- @ UI-improvements End -->
                                </div>
                            </div>
                        </div>
				</div>
			</div>
		</div>
		<div class="clearfix"></div>
		<div class="inspectionDetails" *ngIf="PEService.siteInspection">
			<!-- <div class="subTitle">
				<span>Site Inspection</span>
            </div> -->
            <h4 class="detailsHeading">Site Inspection</h4>
			<div class="row infoWrap">
				<div class="col-sm-8">
					<!-- <div class="row" *ngIf="!PEService.siteInspection">
						<div class="col-sm-6">
							<div class="label-col">Site Inspection</div>
						</div>
						<div class="col-sm-6">
							<div class="info-col">No</div>
						</div>
					</div> -->
					<!-- <label>(OR)</label> -->
					<div *ngIf="PEService.siteInspection">
						<div class="row">
							<div class="col-sm-6">
								<div class="label-col">Site Inspection</div>
							</div>
							<div class="col-sm-6">
								<div class="info-col">Yes</div>
							</div>
						</div>
						<div class="row">
							<div class="col-sm-6">
								<div class="label-col">Date</div>
							</div>
							<div class="col-sm-6">
								<div class="info-col">{{util.getFormatedDate(PEService.siteInspection.inspection_date)}}</div>
							</div>
						</div>
						<div class="row">
							<div class="col-sm-6">
								<div class="label-col">Time</div>
							</div>
							<div class="col-sm-6">
								<div class="info-col">{{PEService.siteInspection.start_time}} {{PEService.siteInspection.start_time_format}}-{{PEService.siteInspection.end_time}} {{PEService.siteInspection.end_time_format}}</div>
							</div>
						</div>
						<div class="row">
							<div class="col-sm-6">
								<div class="label-col">Inspector</div>
							</div>
							<div class="col-sm-6">
								<div class="info-col">{{PEService.siteInspection.inspector_details.first_name}} {{PEService.siteInspection.inspector_details.last_name}}</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
    <div class="button-row clearfix">
      <button class="trea-btn " mat-raised-button  id="downloadPDF" (click)="downloadPDF()">
          Download as PDF
      </button>
      <button
        class="trea-btn" mat-raised-button id="previewBtn" (click)="previewDoc()">
        Preview
      </button>
    </div>
		<div class="button-row">
			<button mat-raised-button class="trea-btn" (click)="showSiteInspectionPopup()">Schedule Site Inspection</button>
			<button mat-raised-button class="trea-btn" (click)="showSaveForFollowUpPopup()">Save for follow up...</button>
    </div>

		<div class="errMsgCon" *ngIf="isError">
			<small>{{errMsg}}</small>
    </div>

		<div class="button-row clearfix">
      <button mat-raised-button class="trea-btn" (click)="editQuotation(quotationDetails.project_estimate_id)">Edit</button>
      <button mat-raised-button class="trea-btn" id="saveAsDraft" (click)="saveAsDraft()">Save</button>
      <!--  *ngIf="quotationStatus" -->
      <button id="pe-approve" mat-raised-button (click)="showConfirmation()" class="trea-btn">Approve</button>
      <!--  *ngIf="quotationStatus" -->
      <button id="pe-send-quote" mat-raised-button (click)="sendQuote()" class="trea-btn">Send To Client</button>
      <button mat-raised-button class="trea-btn" routerLink="/workflow/quote/csa/quotation-list/0" (click)="cancelPE()">Cancel</button>
    </div>

	</div>
</div>




