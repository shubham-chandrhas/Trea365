
<!-- *ngIf="selectedQuotation" -->
<div class="woSubContractorWrap" >
    <div class="pageTitle"><span *ngIf="!isEdit">New</span> <span *ngIf="isEdit">Edit</span> Work Order ({{WOSubContractorObj.WO_TYPE == 'Internal Contractor' ? 'Internal Contractor' : 'External Contractor'}})</div>
  <!-- <div class="pageTitle">New Work Order</div> -->
  <form autocomplete="off" role="form" [formGroup]="woSubContractorForm">
    <div class="infoWrap">
      <div class="row">
        <div class="col-sm-6">
          <div class="row">
            <div class="col-sm-5">
              <div class="label-col">Date</div>
            </div>
            <div class="col-sm-7">
                <div class="info-col">{{util.getFormatedDate(today)}}</div>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-5">
              <div class="label-col">Generated By</div>
            </div>
            <div class="col-sm-7">
                <div class="info-col">{{userInfo.first_name+" "+(userInfo.last_name ? userInfo.last_name : '')}}</div>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-5">
              <div class="label-col">Assigned to</div>
            </div>
            <div class="col-sm-7">
                <div class="info-col" *ngIf="WOSubContractorObj.WO_TYPE == 'Internal Contractor'">Internal Contractor</div>
                <div class="info-col" *ngIf="WOSubContractorObj.WO_TYPE == 'External Contractor'">External Contractor</div>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-5">
              <div class="label-col">Contractor</div>
            </div>
            <div class="col-sm-7">
                <div class="form-group">
                    <div class="autoCompleteList">
                        <div class="searchList">
                            <mat-form-field class="product">
                            <input autocomplete="nope" id=supplier_id matInput placeholder="" [formControl]="supplier_name" [matAutocomplete]="contractorAutoComp" (keyup)="validateContractor($event)" name="contractorNm{{autoNumber}}">
                            <i *ngIf="supplier_name.value!=''" (click)="util.clearAutoComplete('supplier_id', [supplier_name, supplier_id]);" class="clearAutoComplete fa fa-times-circle" aria-hidden="true"></i>
                            <!-- <img *ngIf="supplier_name.value==''" class="selectBoxIcon" aria-hidden src="assets/icon/select.png" /> -->
                            <mat-autocomplete #contractorAutoComp="matAutocomplete">
                            <mat-option *ngFor="let optionIndx=index; let item of filteredContractors | async" [value]="item.supplier_name" (onSelectionChange)="getSelectedContractor(item, $event)">
                            <span>{{ item.supplier_name }}</span>
                            </mat-option>
                            </mat-autocomplete>
                            </mat-form-field>
                        </div>
                    </div>
                    <span class="error-msg" *ngIf="(supplier_id.invalid) && (supplier_id.dirty || supplier_id.touched || submitted)">
                        <small *ngIf="supplier_id.errors.required">Please select Contractor from the list.</small>
                    </span>
                </div>
            </div>
          </div>
        </div>
        <div class="col-sm-6">
          <div class="row">
            <div class="col-sm-5">
              <div class="label-col">Client</div>
            </div>
            <div class="col-sm-7">
                <div class="info-col">{{selectedQuotation.client_name}}</div>
                <!-- <div class="info-col" *ngIf="WOSubContractorObj.WO_TYPE == 'Internal Contractor'">Internal Work</div>
                <div class="info-col" *ngIf="WOSubContractorObj.WO_TYPE == 'External Contractor'">{{selectedQuotation.client_details ? selectedQuotation.client_details.first_name +" "+selectedQuotation.client_details.last_name : ''}}</div> -->
            </div>
          </div>
          <div class="row">
            <div class="col-sm-5">
              <div class="label-col">Work Location</div>
            </div>
            <div class="col-sm-7">
                <div class="info-col">{{selectedQuotation.workLocation}}</div>
            </div>
          </div>


        </div>
      </div>
    </div>

    <div class="repairAssetInfo scheduleWrap" *ngIf="WOSubContractorObj.WO_TYPE == 'Internal Contractor' && WOSubContractorObj.assetsDetails">
      <div class="row">
        <div class="col-sm-8">
          <div class="label-col MB20 ">
            <div class="text-left">Repair Asset Information</div>
        </div>
          <div class="row">
            <div class="col-sm-4">
              <div class="info-col">Manufacturer</div>
            </div>
            <div class="col-sm-8">
              <div class="info-col">{{WOSubContractorObj.assetsDetails.manf_name}}</div>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-4">
              <div class="info-col">Item Definition</div>
            </div>
            <div class="col-sm-8">
                <div class="info-col">{{WOSubContractorObj.assetsDetails.short_name}}</div>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-4">
              <div class="info-col">Name</div>
            </div>
            <div class="col-sm-8">
                <div class="info-col">{{WOSubContractorObj.assetsDetails.full_name}}</div>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-4">
              <div class="info-col">Serial No.</div>
            </div>
            <div class="col-sm-8">
                <div class="info-col">{{WOSubContractorObj.assetsDetails.serial_no}}</div>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-4">
              <div class="info-col">Details</div>
            </div>
            <div class="col-sm-8">
                <div class="info-col" *ngIf="WOSubContractorObj.assetsDetails.mainetenance_req">{{WOSubContractorObj.assetsDetails.asset_details}}</div>
                <div class="form-group" *ngIf="!WOSubContractorObj.assetsDetails.mainetenance_req">
                    <textarea id="" name="comment" style="height: 110px;" formControlName="asset_details" class="form-control"></textarea>
                    <!-- <span class="error-msg" *ngIf="username.invalid && (username.dirty || username.touched || pageData.submitted)">
                        <small *ngIf="username.errors.required">User Name is required.</small>
                        <small *ngIf="username.errors.minlength">User Name must be at least 8 characters long.</small>
                    </span> -->
                </div>
            </div>
          </div>
        </div>
        <div class="clearfix"></div>
      </div>
    </div>

    <div class="scheduleWrap">
      <div class="pageTitle">Schedule</div>
        <div *ngFor="let item of schedules.controls; let indxP=index" [formGroup]="item">
            <!--  -->
            <div class="scheduleOnce" *ngIf="item.get('schedule_type').value == 1">
                <label for="scheduleOnce" style="margin-bottom: 15px;">Schedule Future</label>
                <!-- <div class="treaRadioBtn">
                    <input autocomplete="nope" name="radio-group" type="radio" (change)="changeSchedule('once')" id="scheduleOnce" [checked]="scheduleType == 'once'">
                    <label for="scheduleOnce">Schedule Future</label>
                </div> -->

                <div class="scheduleOnceWrap" *ngIf="scheduleType == 'once'">
                    <div class="form-group">
                        <div class="col-sm-2">
                            <div class="label-col">Start Date</div>
                        </div>
                        <div class="col-sm-4">
                            <div class="dateWrapper">
                                <input autocomplete="nope" type="text" [formControl]="item.get('start_date')" placeholder="" class="date ptrN" [matDatepicker]="pickerStart" [min]="minDate">
                                <mat-datepicker #pickerStart (selectedChanged)="startDateChange($event, indxP)"></mat-datepicker>
                                <span class="dateIcon" (click)="pickerStart.open()"><img src="assets/icon/date_picker.png"></span>
                                <div class="clearfix"></div>
                                <span class="error-msg" *ngIf="item.get('start_date').invalid && (item.get('start_date').dirty || item.get('start_date').touched || submitted)">
                                    <small *ngIf="item.get('start_date').errors.required">Start Date is required.</small>
                                </span>
                            </div> 
                        </div>
                        <div class="col-sm-2">
                            <div class="label-col">End Date</div>
                        </div>
                        <div class="col-sm-4">
                            <div class="dateWrapper">
                                <input autocomplete="nope" type="text" [formControl]="item.get('end_date')" placeholder="" class="date ptrN" [matDatepicker]="pickerEnd" [min]="item.get('start_date').value">
                                <mat-datepicker #pickerEnd></mat-datepicker>
                                <span class="dateIcon" (click)="pickerEnd.open()"><img src="assets/icon/date_picker.png"></span>
                                <div class="clearfix"></div>
                                <span class="error-msg" *ngIf="item.get('end_date').invalid && (item.get('end_date').dirty || item.get('end_date').touched || submitted)">
                                    <small *ngIf="item.get('end_date').errors.required">End Date is required.</small>
                                </span>
                            </div> 
                        </div>
                        <div class="clearfix"></div>
                    </div>
                    <div class="form-group timeWrap">
                        <div class="col-sm-2">
                            <div class="label-col">Start Time</div>
                        </div>
                        <div class="col-sm-4">
                            <div class="time">
                                <input autocomplete="nope" [textMask]="{mask: constant.TIME_MASK}" placeholder="__:__" [formControl]="item.get('start_time')" type="text" name="" class="hours"/>
                                <select formControlName="start_time_format" class="">
                                    <option [value]="'am'">am</option>
                                    <option [value]="'pm'">pm</option>
                                </select>
                            </div>
                            <span class="error-msg" *ngIf="item.get('start_time').invalid && (item.get('start_time').dirty || item.get('start_time').touched || submitted)">
                                <small *ngIf="item.get('start_time').errors.required">Start Time is required.</small>
                                <small *ngIf="item.get('start_time').errors.pattern">Enter valid Start Time.</small>
                            </span>
                        </div>
                        <div class="col-sm-2">
                            <div class="label-col">End Time</div>
                        </div>
                        <div class="col-sm-4">
                            <div class="time">
                                <input autocomplete="nope" [textMask]="{mask: constant.TIME_MASK}" placeholder="__:__" [formControl]="item.get('end_time')" type="text" name="" class="hours"/>
                                <select formControlName="end_time_format" class="">
                                    <option [value]="'am'">am</option>
                                    <option [value]="'pm'">pm</option>
                                </select>
                            </div>
                            <span class="error-msg" *ngIf="item.get('end_time').invalid && (item.get('end_time').dirty || item.get('end_time').touched || submitted)">
                                <small *ngIf="item.get('end_time').errors.required">End Time is required.</small>
                                <small *ngIf="item.get('end_time').errors.pattern">Enter valid End Time.</small>
                            </span>
                        </div>
                        <div class="clearfix"></div>
                    </div>
                </div>

            </div>

            <div class="scheduleRecurring" *ngIf="item.get('schedule_type').value == 2">
                <div class="treaRadioBtn">
                    <input autocomplete="nope" name="radio-group" type="radio" (change)="changeSchedule('recurring')" id="scheduleRecurring" [checked]="scheduleType == 'recurring'">
                    <label for="scheduleRecurring">Schedule Recurring</label>
                </div>
            
                <div class="recurringWrap" *ngIf="scheduleType == 'recurring'">
                    <div class="form-group">
                        <div class="col-sm-6">
                            <div class="row">
                                <div class="col-sm-4">
                                    <div class="label-col">Repeat</div>
                                </div>
                                <div class="col-sm-8">
                                    <div class="form-group selectRepeat pull-left">
                                        <div class="autoCompleteList">
                                            <div class="searchList">
                                                <mat-form-field class="product">
                                                    <input autocomplete="nope" matInput placeholder=""  [formControl]="item.get('schedule_repeat_name')" [matAutocomplete]="EmpAutoComp" (keyup)="validateRepeat($event)" id="repeat_id">
                                                    <i *ngIf="item.get('schedule_repeat_name').value!=''" (click)="util.clearAutoComplete('repeat_id', [schedule_repeat_name, schedule_repeat]);" class="clearAutoComplete fa fa-times-circle" aria-hidden="true"></i>
                                                    <img *ngIf="item.get('schedule_repeat_name').value==''" class="selectBoxIcon" aria-hidden src="assets/icon/select.png" />
                                                    <mat-autocomplete #EmpAutoComp="matAutocomplete">
                                                        <mat-option *ngFor="let indx=index; let item of filteredScheduleRepeat | async" [value]="item.status" (onSelectionChange)="getSelectedRepeat(item,$event)">
                                                        <span>{{ item.status }}</span>
                                                        </mat-option>
                                                    </mat-autocomplete>
                                                </mat-form-field>
                                            </div>
                                        </div>
                                        <!-- <span class="error-msg" *ngIf="schedule_repeat_name.invalid && (schedule_repeat_name.dirty || schedule_repeat_name.touched || submitted)">
                                            <small *ngIf="schedule_repeat_name.errors.required">Please select Asset from the list.</small>
                                        </span> -->
                                    </div>
                                    <div class="info-col onTxt pull-right">on</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6 PadL0">
                            <div class="weekDaysWrap" *ngFor="let days of item.get('days_off').controls" [formGroup]="days">
                                <div class="days Mar0">
                                    <div class="label-col">Sun</div>
                                    <div class="checkBox">
                                        <label>
                                            <input autocomplete="nope" type="checkbox" formControlName="sunday">
                                            <span class="iconChk"><i class="fa fa-check"></i> </span>
                                        </label>
                                    </div>
                                </div>
                                <div class="days">
                                    <div class="label-col">Mon</div>
                                    <div class="checkBox">
                                        <label>
                                            <input autocomplete="nope" type="checkbox" formControlName="monday">
                                            <span class="iconChk"><i class="fa fa-check"></i> </span>
                                        </label>
                                    </div>
                                </div>
                                <div class="days">
                                    <div class="label-col">Tue</div>
                                    <div class="checkBox">
                                        <label>
                                            <input autocomplete="nope" type="checkbox" formControlName="tuesday">
                                            <span class="iconChk"><i class="fa fa-check"></i> </span>
                                        </label>
                                    </div>
                                </div>
                                <div class="days">
                                    <div class="label-col">Wed</div>
                                    <div class="checkBox">
                                        <label>
                                            <input autocomplete="nope" type="checkbox" formControlName="wednesday">
                                            <span class="iconChk"><i class="fa fa-check"></i> </span>
                                        </label>
                                    </div>
                                </div>
                                <div class="days">
                                    <div class="label-col">Thu</div>
                                    <div class="checkBox">
                                        <label>
                                            <input autocomplete="nope" type="checkbox" formControlName="thursday">
                                            <span class="iconChk"><i class="fa fa-check"></i> </span>
                                        </label>
                                    </div>
                                </div>
                                <div class="days">
                                    <div class="label-col">Fri</div>
                                    <div class="checkBox">
                                        <label>
                                            <input autocomplete="nope" type="checkbox" formControlName="friday">
                                            <span class="iconChk"><i class="fa fa-check"></i> </span>
                                        </label>
                                    </div>
                                </div>
                                <div class="days">
                                    <div class="label-col">Sat</div>
                                    <div class="checkBox">
                                        <label>
                                            <input autocomplete="nope" type="checkbox" formControlName="saturday">
                                            <span class="iconChk"><i class="fa fa-check"></i> </span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="clearfix"></div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-2">
                            <div class="label-col">Start Date</div>
                        </div>
                        <div class="col-sm-4">
                            <div class="dateWrapper">
                                <input autocomplete="nope" type="text" [formControl]="item.get('start_date')" placeholder="" class="date ptrN" [matDatepicker]="pickerStart" [min]="minDate">
                                <mat-datepicker #pickerStart (selectedChanged)="startDateChange($event, indxP)"></mat-datepicker>
                                <span class="dateIcon" (click)="pickerStart.open()"><img src="assets/icon/date_picker.png"></span>
                                <div class="clearfix"></div>
                                <span class="error-msg" *ngIf="item.get('start_date').invalid && (item.get('start_date').dirty || item.get('start_date').touched || submitted)">
                                    <small *ngIf="item.get('start_date').errors.required">Start Date is required.</small>
                                </span>
                            </div> 
                            
                        </div>
                        <div class="col-sm-2">
                            <div class="label-col">End Date</div>
                        </div>
                        <div class="col-sm-4 Pad0">
                            <div class="dateWrapper">
                                <div class="treaRadioBtn">
                                    <input autocomplete="nope" name="endDate" type="radio" id="endDate2"  (change)="changeOccrence('endDate')" [checked]="!is_after">
                                    <label for="endDate2"></label>
                                </div>
                                <input autocomplete="nope" type="text" [formControl]="item.get('end_date')" placeholder="" class="date ptrN" [matDatepicker]="pickerEnd" [min]="item.get('start_date').value">
                                <mat-datepicker #pickerEnd></mat-datepicker>
                                <span class="dateIcon" (click)="pickerEnd.open()" [ngClass]="{'ptrN' : is_after}"><img src="assets/icon/date_picker.png"></span>
                                <div class="clearfix"></div>
                                <span style="margin-left: 32px;" class="error-msg" *ngIf="item.get('end_date').invalid && (item.get('end_date').dirty || item.get('end_date').touched || submitted)">
                                    <small *ngIf="item.get('end_date').errors.required">End Date is required.</small>
                                </span>
                            </div>
                            <div class="afterOccurWrap">
                                <div class="treaRadioBtn">
                                    <input autocomplete="nope" name="endDate" type="radio" id="Occurences"  (change)="changeOccrence('after')" [checked]="is_after">
                                    <label for="Occurences">After</label>
                                </div>
                                <div class="occurence">
                                    <input autocomplete="nope" type="number" name="" [formControl]="item.get('end_after_occurences')" [ngClass]="{'ptrN' : !is_after}"/>
                                    <span>Occurences</span>
                                    <span class="error-msg" *ngIf="item.get('end_after_occurences').invalid && (item.get('end_after_occurences').dirty || item.get('end_after_occurences').touched || submitted)">
                                        <small *ngIf="item.get('end_after_occurences').errors.min">Enter occurence more than 0.</small>
                                        <small *ngIf="item.get('end_after_occurences').errors.max">Enter occurence bellow 52.</small>
                                    </span>
                                </div>
                            </div> 
                        </div>
                        <div class="clearfix"></div>
                    </div>
                    <div class="form-group timeWrap">
                        <div class="col-sm-2">
                            <div class="label-col">Start Time</div>
                        </div>
                        <div class="col-sm-4">
                            <div class="time">
                                <input autocomplete="nope" [textMask]="{mask: constant.TIME_MASK}" placeholder="__:__" [formControl]="item.get('start_time')" type="text" name="" class="hours"/>
                                <select formControlName="start_time_format" class="">
                                    <option [value]="'am'">am</option>
                                    <option [value]="'pm'">pm</option>
                                </select>
                            </div>
                            <span class="error-msg" *ngIf="item.get('start_time').invalid && (item.get('start_time').dirty || item.get('start_time').touched || submitted)">
                                <small *ngIf="item.get('start_time').errors.required">Start Time is required.</small>
                                <small *ngIf="item.get('start_time').errors.pattern">Enter valid Start Time.</small>
                            </span>
                        </div>
                        <div class="col-sm-2">
                            <div class="label-col">End Time</div>
                        </div>
                        <div class="col-sm-4">
                            <div class="time">
                                <input autocomplete="nope" [textMask]="{mask: constant.TIME_MASK}" placeholder="__:__" [formControl]="item.get('end_time')" type="text" name="" class="hours"/>
                                <select formControlName="end_time_format" class="">
                                    <option [value]="'am'">am</option>
                                    <option [value]="'pm'">pm</option>
                                </select>
                            </div>
                            <span class="error-msg" *ngIf="item.get('end_time').invalid && (item.get('end_time').dirty || item.get('end_time').touched || submitted)">
                                <small *ngIf="item.get('end_time').errors.required">End Time is required.</small>
                                <small *ngIf="item.get('end_time').errors.pattern">Enter valid End Time.</small>
                            </span>
                        </div>
                        <div class="clearfix"></div>
                    </div>
                </div>
            </div>

            <!-- <div class="scheduleInfinite">
                <div class="treaRadioBtn MB20">
                    <input autocomplete="nope" name="radio-group" type="radio" (change)="changeSchedule('indefinitely')" id="scheduleNow" [checked]="scheduleType == 'indefinitely'">
                    <label for="scheduleNow">Schedule Indefinitely</label>
                </div>
                <div class="scheduleNow" *ngIf="scheduleType == 'indefinitely'">
                </div>
            </div> -->
        </div>
    </div>

    <div class="servicesWrap">
      <div class="pageTitle">Services</div>
        <!-- <div *ngIf="isEdit">
            <div class="row" *ngFor="let service of selectedQuotation.services; let indx=index">
                <div class="col-sm-12">   
                    <div class="col-sm-2">
                        <div class="info-col">
                            <span class="closeIcon bold">Service</span>
                        </div>
                    </div>
                    <div class="col-sm-3">
                        <div class="form-group">
                            {{service.service_defination.service_definition}}
                        </div>
                    </div>
                    <div class="col-sm-2">
                        <div class="info-col bold">Quantity</div>
                    </div>
                    <div class="col-sm-2">
                        <div class="form-group">
                            {{service.quantity}}
                        </div>
                    </div>
                    <div class="col-sm-1">
                        <div class="info-col bold">Cost</div>
                    </div>
                    <div class="col-sm-2">
                        <div class="form-group">
                            {{service.cost | currency: util.getCurrency() :'symbol-narrow'}}
                        </div>
                        <div class="clearfix"></div>
                    </div>
                </div>
                <div class="col-sm-12 MB20">
                    <div class="col-sm-2">
                        <div class="info-col">
                            <span class="closeIcon bold">Details</span>
                        </div>
                    </div>
                    <div class="col-sm-5">
                        <div class="form-group">
                            {{service.details}}
                        </div>
                    </div>
                </div>
            </div>

            <div style="padding: 30px 8px 50px 8px;font-weight: 700 !important;text-align: center; ">
                Total Amount  {{selectedQuotation.cost_of_services | currency: util.getCurrency() :'symbol-narrow'}}   
            </div>
        </div> -->
        <div class="row" *ngFor="let service of services.controls; let indx=index" [formGroup]="service">
            <div class="col-sm-12">   
                <div class="col-sm-2">
                    <div class="info-col">
                        <span class="closeIcon"> <img *ngIf="indx != 0 || isEdit" (click)="removeService(indx, service)" src="assets/icon/close_icon.png" /></span> 
                        Service</div>
                </div>
                <div class="col-sm-3">
                    <div class="form-group">
                        <div class="autoCompleteList">
                            <div class="searchList">
                                <mat-form-field class="product">
                                <input autocomplete="nope" id=service_{{indx}} matInput placeholder=""  [formControl]="service.get('service_definition')" [matAutocomplete]="servicesAutoComp" (keyup)="validateService($event, service, indx)">
                                <i *ngIf="service.get('service_definition').value!=''" (click)="util.clearAutoComplete('service_', [service.get('service_definition'), service.get('service_definition_id'), service.get('cost'), service.get('quantity'), service.get('total_amount'), service.get('details')],indx); clearService(service, service.get('total_amount').value);" class="clearAutoComplete fa fa-times-circle" aria-hidden="true"></i>
                                <!-- <img *ngIf="service.get('service_definition').value==''" class="selectBoxIcon" aria-hidden src="assets/icon/select.png" /> -->
                                <mat-autocomplete #servicesAutoComp="matAutocomplete">
                                <mat-option *ngFor="let optionIndx=index; let item of service.get('filteredService').value | async | sortBy:'serviceDefinition':'ASC':'A'" [value]="item.serviceDefinition" (onSelectionChange)="getSelectedService(item, $event, indx)">
                                <span>{{ item.serviceDefinition }}</span>
                                </mat-option>
                                </mat-autocomplete>
                                </mat-form-field>
                            </div>
                        </div>
                        <span class="error-msg" *ngIf="(service.get('service_definition').invalid) && (service.get('service_definition').dirty || service.get('service_definition').touched || submitted)">
                            <small *ngIf="service.get('service_definition').errors.required">Please select Service from the list.</small>
                        </span>
                    </div>
                </div>
                <div class="col-sm-2">
                    <div class="info-col">Quantity</div>
                </div>
                <div class="col-sm-2">
                    <div class="form-group">
                        <input autocomplete="nope" type="number" class="inputQty PadR0" formControlName="quantity" (change)="calculateTotal($event, service, indx)">
                        <span class="error-msg" *ngIf="(service.get('quantity').invalid) && (service.get('quantity').dirty || service.get('quantity').touched || submitted)">
                            <small *ngIf="service.get('quantity').errors.required">Quantity is Required.</small>
                            <small *ngIf="service.get('quantity').errors.pattern">Invalid Quantity.</small>
                        </span>
                    </div>
                </div>
                <div class="col-sm-1">
                    <div class="info-col">Cost</div>
                </div>
                <div class="col-sm-2">
                    <div class="form-group">
                    <input autocomplete="nope" type="text" class="inputCost" formControlName="cost" (keyup)="calculateTotal($event, service, indx)" (change)="calculateTotal($event, service, indx)">
                    <span class="error-msg" *ngIf="(service.get('cost').invalid) && (service.get('cost').dirty || service.get('cost').touched || submitted)">
                        <small *ngIf="service.get('cost').errors.required">Price is Required.</small>
                        <small *ngIf="service.get('cost').errors.pattern">Invalid Price.</small>
                    </span>
                    </div>
                </div>
                <div class="clearfix"></div>
            </div>
            <div class="col-sm-12">
                <div class="col-sm-2">
                    <div class="info-col">Details</div>
                </div>
                <div class="col-sm-5">
                    <div class="form-group">
                    <textarea id="" style="height: 110px;" class="form-control" formControlName="details"></textarea>
                    <!-- <span class="error-msg" *ngIf="username.invalid && (username.dirty || username.touched || pageData.submitted)">
                        <small *ngIf="username.errors.required">User Name is required.</small>
                    </span> -->
                    </div>
                </div>
            </div>
        </div>

        <span class="addIcon MB20 cursorPtr" (click)="addServices('0')">
            <img src="assets/icon/icon-add.png"><span>Add Service</span>
        </span>
        <div class="clearfix"></div>
        <!-- <div *ngIf="isEdit && services.controls.length > 0" style="padding: 30px 8px 20px 8px;font-weight: 700 !important;text-align: center; color: #dd4b39;">
            New Total Amount  {{woSubContractorForm.get('services_amount').value | currency: util.getCurrency() :'symbol-narrow'}}   
        </div> -->
    </div>

    <div class="paymentScheduleWrap">
      
      <div *ngFor="let cost of costs.controls; let indx=index" [formGroup]="cost">
        <div class="clearfix">
            <div class="col-sm-12">
                <div class="row">
                    <div class="col-sm-6">
                        <div class="label-col">Cost of Services</div>
                    </div>
                    <div class="col-sm-6">
                        <div class="label-col"><span>{{cost.get('cost_of_services').value | currency: util.getCurrency() :'symbol-narrow'}}</span> </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="clearfix">
            <div class="col-sm-12">
                <div class="row">
                    <div class="col-sm-6">
                        <div class="label-col">Shipping and Handling</div>
                    </div>
                    <div class="col-sm-6">
                        <div class="info-col  pull-right">
                            <input autocomplete="nope" type="text" formControlName="shipping_handling" (keyup)="calculateSubTotal()">
                            <span class="error-msg" *ngIf="(cost.get('shipping_handling').invalid) && (cost.get('shipping_handling').dirty || cost.get('shipping_handling').touched || submitted)">
                                <small *ngIf="cost.get('shipping_handling').errors.required">Shipping and Handling is Required.</small>
                                <small *ngIf="cost.get('shipping_handling').errors.pattern">Invalid Shipping and Handling.</small>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="clearfix">
            <div class="col-sm-12">
                <div class="row">
                    <div class="col-sm-6">
                        <div class="label-col">Adjustment</div>
                    </div>
                    <div class="col-sm-6">
                        <div class="info-col pull-right">
                            <input autocomplete="nope" type="text" formControlName="adjustment" (keyup)="calculateSubTotal()">
                            <span class="error-msg" *ngIf="(cost.get('adjustment').invalid) && (cost.get('adjustment').dirty || cost.get('adjustment').touched || submitted)">
                                <small *ngIf="cost.get('adjustment').errors.required">Adjustment is Required.</small>
                                <small *ngIf="cost.get('adjustment').errors.pattern">Invalid Adjustment.</small>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="calculateSection">
            <div class="clearfix">
                <div class="col-sm-12">
                    <div class="row">
                        <div class="col-sm-6">
                            <div class="label-col">Subtotal</div>
                        </div>
                        <div class="col-sm-6">
                            <!-- <div class="label-col"><span>$xxxxxx</span> </div> -->
                            <div class="label-col"><span>{{cost.get('sub_total').value | currency: util.getCurrency() :'symbol-narrow'}}</span> </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="clearfix">
                <div class="col-sm-12">
                    <div class="row">
                        <div class="col-sm-6 PadR0">
                            <div class="label-col">Taxes
                                <input autocomplete="nope" type="text" name="" class="taxes" formControlName="taxes" (keyup)="calculateTaxes()"/>
                                <span>%</span>
                                <span class="error-msg" *ngIf="(cost.get('taxes').invalid) && (cost.get('taxes').dirty || cost.get('taxes').touched || submitted)">
                                    <!-- <small *ngIf="cost.get('taxes').errors.required">Taxes is Required.</small> -->
                                    <small *ngIf="cost.get('taxes').errors.pattern">Invalid Taxes.</small>
                                </span>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="label-col">
                                {{cost.get('tax_amount').value | currency: util.getCurrency() :'symbol-narrow'}}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="clearfix">
                <div class="col-sm-12">
                    <div class="row">
                        <div class="col-sm-6">
                            <div class="label-col">Total Cost </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="label-col">
                                {{cost.get('total_cost').value | currency: util.getCurrency() :'symbol-narrow'}}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="pageTitle">Payment Schedule</div>

        <div class="form-group" *ngFor="let payment of payment_schedules.controls; let indx=index;" [formGroup]="payment">
            <div class="col-sm-2">
                <div class="info-col">
                    <span class="closeIcon"> <img *ngIf="indx != 0" (click)="removePaySchedule(indx, payment)" src="assets/icon/close_icon.png" /></span>  Date
                </div>
            </div>
            <div class="col-sm-4">
                <div class="dateWrapper">
                    <input autocomplete="nope" type="text" placeholder="" formControlName="date" class="date" [matDatepicker]="dueDate" [min]="minDate" style="pointer-events: none;">
                    <mat-datepicker #dueDate ></mat-datepicker>
                    <span class="dateIcon" (click)="dueDate.open()"><img src="assets/icon/date_picker.png" class="img-responsive"></span>
                    <span class="error-msg" *ngIf="(payment.get('date').invalid) && (payment.get('date').dirty || payment.get('date').touched || submitted)">
                        <small *ngIf="payment.get('date').errors.required">Date is Required.</small>
                        <small *ngIf="payment.get('date').errors.min">Please enter upcoming date.</small>
                    </span>  
                </div>
            </div>
            <div class="col-sm-3">
                <div class="info-col text-right">Amount Due</div>
            </div>
            <div class="col-sm-3">
                <div class="info-col">
                    <input autocomplete="nope" type="text" formControlName="amount_due" (keyup)="calculatePaymentAmount()">
                    <span class="error-msg" *ngIf="(payment.get('amount_due').invalid) && (payment.get('amount_due').dirty || payment.get('amount_due').touched || submitted)">
                        <small *ngIf="payment.get('amount_due').errors.required">Amount Due is Required.</small>
                        <small *ngIf="payment.get('amount_due').errors.pattern">Invalid Amount Due.</small>
                    </span>
                </div>
            </div>
            <div class="clearfix"></div>
        </div>
        <div class="form-group">
            <div class="morePayDates">
                <span class="addIcon MB30 cursorPtr" (click)="addPaymentSchedule('0')">
                    <img src="assets/icon/icon-add.png"><span>Add Payment Date</span>
                </span>
            </div>
        </div>
        <div class="form-group clearfix">
            <div class="totalPayAmt col-sm-12">
                <div class="label-col text-center MB20">
                    <div class="label-col">
                        <span>Remaining Amount </span>
                        <span>{{pageVariables.remainingPaymentAmount | currency: util.getCurrency() :'symbol-narrow'}}</span>
                        <div class="clearfix"></div>
                    </div>
                    
                    <div class="label-col">
                        <span>Total Payment Amount </span>
                        <span>{{pageVariables.totalPaymentAmount | currency: util.getCurrency() :'symbol-narrow'}}</span>
                    </div> 

                    <!-- <div *ngIf="isEdit && services.controls.length > 0">
                        <div class="label-col" style="text-decoration: line-through;">
                            <span>Total Payment Amount </span>
                            <span>{{pageVariables.totalPaymentAmount | currency: util.getCurrency() :'symbol-narrow'}}</span>  
                        </div>
                        <div class="label-col" style="color: #dd4b39;">New Total Amount  {{pageVariables.newTotalPaymentAmount | currency: util.getCurrency() :'symbol-narrow'}}</div>   
                    </div> -->
                </div>
            </div>
        </div>
        <div class="form-group">
            <div class="totalPayAmt col-sm-12">
                <div class="label-col text-center MB20">
                    <div class="clearfix"></div>
                    <div class="errMsgCon" *ngIf="totalPayErr"> 
                        <small>{{errMsg}}</small>
                    </div>
                </div>
            </div>
        </div>
      </div>
      <div class="clearfix button-row">
      <button *ngIf="isEdit" id="updateWO" mat-raised-button class="trea-btn" type="button" (click)="createExtWorkOrder(woSubContractorForm)">Update</button>
      <button *ngIf="!isEdit" id="" mat-raised-button class="trea-btn" type="button" (click)="createExtWorkOrder(woSubContractorForm)">Next</button>
      <button mat-raised-button class="trea-btn" type="button" routerLink="/workflow/wo/csa/work-order-list/0">Cancel</button>  
    </div>
    </div>

    
  </form>
</div>
